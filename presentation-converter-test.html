<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç°¡å ±è½‰æ›æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .btn { padding: 15px 30px; font-size: 16px; background: #e74c3c; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 10px; }
        .btn:hover { background: #c0392b; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        .file-input { margin: 10px 0; }
        .format-select { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ“Š ç°¡å ±è½‰æ›å™¨æ¸¬è©¦</h1>
    <p>æ¸¬è©¦ç°¡å ±è½‰æ›ç‚ºå„ç¨®æ ¼å¼ï¼ˆPDFã€HTMLã€TXTï¼‰</p>
    
    <div class="file-input">
        <label for="presentationFile">é¸æ“‡ç°¡å ±æª”æ¡ˆï¼š</label>
        <input type="file" id="presentationFile" accept=".pptx,.ppt,.pdf">
    </div>
    
    <div class="format-select">
        <label for="outputFormat">è¼¸å‡ºæ ¼å¼ï¼š</label>
        <select id="outputFormat">
            <option value="pdf">PDF æ–‡ä»¶</option>
            <option value="html">HTML ç¶²é </option>
            <option value="txt">ç´”æ–‡å­—</option>
        </select>
    </div>
    
    <button class="btn" onclick="testPresentationConversion()">ğŸš€ é–‹å§‹è½‰æ›æ¸¬è©¦</button>
    <button class="btn" onclick="testWithSampleData()" style="background: #3498db;">ğŸ“ ä½¿ç”¨ç¯„ä¾‹è³‡æ–™æ¸¬è©¦</button>
    
    <div id="results"></div>

    <script src="assets/js/converters/presentation.js"></script>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `
                <strong>${new Date().toLocaleTimeString()}</strong> - ${message}
            `;
            document.getElementById('results').appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testPresentationConversion() {
            clearResults();
            log('ğŸ”„ é–‹å§‹ç°¡å ±è½‰æ›æ¸¬è©¦...');
            
            const fileInput = document.getElementById('presentationFile');
            const outputFormat = document.getElementById('outputFormat').value;
            const file = fileInput.files[0];
            
            if (!file) {
                log('âŒ è«‹å…ˆé¸æ“‡ç°¡å ±æª”æ¡ˆ', 'error');
                return;
            }
            
            try {
                log(`ğŸ“ æª”æ¡ˆ: ${file.name} (${(file.size/1024).toFixed(1)}KB)`);
                log(`ğŸ”§ è¼¸å‡ºæ ¼å¼: ${outputFormat.toUpperCase()}`);
                
                // 1. æª¢æŸ¥ PresentationConverter æ˜¯å¦è¼‰å…¥
                if (typeof PresentationConverter === 'undefined') {
                    log('âŒ PresentationConverter æœªè¼‰å…¥', 'error');
                    return;
                }
                log('âœ… PresentationConverter è¼‰å…¥æˆåŠŸ');
                
                // 2. é©—è­‰æª”æ¡ˆæ ¼å¼
                const isValid = PresentationConverter.isValidPresentationFile(file);
                if (!isValid) {
                    log('âŒ ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼', 'error');
                    return;
                }
                log('âœ… æª”æ¡ˆæ ¼å¼é©—è­‰é€šé');
                
                // 3. æå–ç°¡å ±å…§å®¹
                log('ğŸ” æ­£åœ¨æå–ç°¡å ±å…§å®¹...');
                const content = await PresentationConverter.extractPresentationContent(file);
                log(`âœ… å…§å®¹æå–æˆåŠŸ: ${content.totalSlides || 1} å¼µæŠ•å½±ç‰‡`, 'success');
                
                // 4. æ ¹æ“šé¸æ“‡çš„æ ¼å¼è½‰æ›
                log(`ğŸ”„ æ­£åœ¨è½‰æ›ç‚º ${outputFormat.toUpperCase()} æ ¼å¼...`);
                let outputBlob;
                let filename;
                
                const title = file.name.replace(/\.[^/.]+$/, '');
                
                switch (outputFormat) {
                    case 'pdf':
                        outputBlob = await PresentationConverter.convertToPdf(content, title);
                        filename = `${title}_ç°¡å ±.pdf`;
                        break;
                    case 'html':
                        outputBlob = PresentationConverter.convertToHtml(content, title);
                        filename = `${title}_ç°¡å ±.html`;
                        break;
                    case 'txt':
                        outputBlob = PresentationConverter.convertToText(content, title);
                        filename = `${title}_ç°¡å ±.txt`;
                        break;
                    default:
                        throw new Error('ä¸æ”¯æ´çš„è¼¸å‡ºæ ¼å¼');
                }
                
                if (outputBlob && outputBlob.size > 0) {
                    log(`âœ… ${outputFormat.toUpperCase()} è½‰æ›æˆåŠŸï¼æª”æ¡ˆå¤§å°: ${outputBlob.size} bytes`, 'success');
                    
                    // è‡ªå‹•ä¸‹è¼‰
                    const url = URL.createObjectURL(outputBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    setTimeout(() => URL.revokeObjectURL(url), 1000);
                    log(`ğŸ“¥ ${filename} å·²è‡ªå‹•ä¸‹è¼‰`, 'success');
                } else {
                    log('âŒ è½‰æ›å¤±æ•—ï¼šç”¢ç”Ÿç©ºæª”æ¡ˆ', 'error');
                }
                
            } catch (error) {
                log(`âŒ è½‰æ›éŒ¯èª¤: ${error.message}`, 'error');
                console.error('è©³ç´°éŒ¯èª¤:', error);
            }
        }

        async function testWithSampleData() {
            clearResults();
            log('ğŸ”„ é–‹å§‹ç¯„ä¾‹è³‡æ–™æ¸¬è©¦...');
            
            const outputFormat = document.getElementById('outputFormat').value;
            
            try {
                // å»ºç«‹ç¯„ä¾‹ç°¡å ±è³‡æ–™
                const sampleContent = {
                    title: 'ç¯„ä¾‹ç°¡å ±æ¸¬è©¦',
                    slides: [
                        {
                            slideNumber: 1,
                            title: 'æ­¡è¿æŠ•å½±ç‰‡',
                            content: [
                                'æ­¡è¿ä½¿ç”¨ç°¡å ±è½‰æ›å™¨',
                                'é€™æ˜¯ç¬¬ä¸€å¼µæŠ•å½±ç‰‡',
                                'æ¸¬è©¦ä¸­æ–‡å­—ç¬¦é¡¯ç¤º',
                                'â€¢ é …ç›®ç¬¦è™Ÿæ¸¬è©¦',
                                'â€¢ æ ¼å¼åŒ–æ–‡å­—æ¸¬è©¦',
                                'â€¢ å¤šè¡Œå…§å®¹æ¸¬è©¦'
                            ],
                            notes: 'é€™æ˜¯ç¬¬ä¸€å¼µæŠ•å½±ç‰‡çš„å‚™è¨»'
                        },
                        {
                            slideNumber: 2,
                            title: 'åŠŸèƒ½ä»‹ç´¹',
                            content: [
                                'æ”¯æ´çš„åŠŸèƒ½ï¼š',
                                '1. PowerPoint æª”æ¡ˆè§£æ',
                                '2. PDF æ ¼å¼è¼¸å‡º',
                                '3. HTML æ ¼å¼è¼¸å‡º',
                                '4. ç´”æ–‡å­—æ ¼å¼è¼¸å‡º',
                                '',
                                'ç‰¹è‰²ï¼š',
                                'âœ¨ ä¿æŒä¸­æ–‡å­—ç¬¦',
                                'ğŸ“Š å°ˆæ¥­æ’ç‰ˆ',
                                'ğŸ”§ å¤šæ ¼å¼æ”¯æ´'
                            ],
                            notes: 'åŠŸèƒ½ä»‹ç´¹æŠ•å½±ç‰‡'
                        },
                        {
                            slideNumber: 3,
                            title: 'çµèª',
                            content: [
                                'æ„Ÿè¬ä½¿ç”¨ç°¡å ±è½‰æ›å™¨ï¼',
                                '',
                                'å¦‚æœ‰å•é¡Œè«‹è¯çµ¡æŠ€è¡“æ”¯æ´',
                                'ç¶²å€ï¼šhttps://example.com',
                                'é›»å­éƒµä»¶ï¼šsupport@example.com'
                            ],
                            notes: 'çµèªæŠ•å½±ç‰‡'
                        }
                    ],
                    totalSlides: 3,
                    metadata: {
                        fileType: 'sample',
                        extractedAt: new Date().toISOString(),
                        isValid: true
                    }
                };
                
                log('âœ… ç¯„ä¾‹è³‡æ–™å»ºç«‹æˆåŠŸ');
                log(`ğŸ“Š åŒ…å« ${sampleContent.totalSlides} å¼µæŠ•å½±ç‰‡`);
                
                // è½‰æ›
                log(`ğŸ”„ æ­£åœ¨è½‰æ›ç‚º ${outputFormat.toUpperCase()} æ ¼å¼...`);
                let outputBlob;
                let filename;
                
                const title = 'ç¯„ä¾‹ç°¡å ±æ¸¬è©¦';
                
                switch (outputFormat) {
                    case 'pdf':
                        outputBlob = await PresentationConverter.convertToPdf(sampleContent, title);
                        filename = `${title}.pdf`;
                        break;
                    case 'html':
                        outputBlob = PresentationConverter.convertToHtml(sampleContent, title);
                        filename = `${title}.html`;
                        break;
                    case 'txt':
                        outputBlob = PresentationConverter.convertToText(sampleContent, title);
                        filename = `${title}.txt`;
                        break;
                }
                
                if (outputBlob && outputBlob.size > 0) {
                    log(`âœ… ç¯„ä¾‹ ${outputFormat.toUpperCase()} è½‰æ›æˆåŠŸï¼æª”æ¡ˆå¤§å°: ${outputBlob.size} bytes`, 'success');
                    
                    // è‡ªå‹•ä¸‹è¼‰
                    const url = URL.createObjectURL(outputBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    setTimeout(() => URL.revokeObjectURL(url), 1000);
                    log(`ğŸ“¥ ${filename} å·²è‡ªå‹•ä¸‹è¼‰`, 'success');
                } else {
                    log('âŒ ç¯„ä¾‹è½‰æ›å¤±æ•—ï¼šç”¢ç”Ÿç©ºæª”æ¡ˆ', 'error');
                }
                
            } catch (error) {
                log(`âŒ ç¯„ä¾‹è½‰æ›éŒ¯èª¤: ${error.message}`, 'error');
                console.error('è©³ç´°éŒ¯èª¤:', error);
            }
        }

        // é é¢è¼‰å…¥æª¢æŸ¥
        window.addEventListener('load', function() {
            log('ğŸš€ ç°¡å ±è½‰æ›æ¸¬è©¦é é¢è¼‰å…¥å®Œæˆ');
            
            if (typeof PresentationConverter !== 'undefined') {
                log('âœ… PresentationConverter è¼‰å…¥æˆåŠŸ', 'success');
            } else {
                log('âŒ PresentationConverter è¼‰å…¥å¤±æ•—', 'error');
            }
        });
    </script>
</body>
</html>