<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æª”æ¡ˆè½‰æ›å™¨åŠŸèƒ½æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; max-width: 1200px; margin: 0 auto; }
        .test-panel { background: #f5f5f5; padding: 20px; margin: 20px 0; border-radius: 8px; border: 1px solid #ddd; }
        .test-btn { background: #007bff; color: white; border: none; padding: 10px 20px; margin: 5px; cursor: pointer; border-radius: 5px; }
        .test-btn:hover { background: #0056b3; }
        .success { color: #28a745; font-weight: bold; }
        .error { color: #dc3545; font-weight: bold; }
        .info { color: #17a2b8; }
        .status-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin: 20px 0; }
        .status-card { background: white; border: 1px solid #ddd; border-radius: 8px; padding: 15px; }
        .status-header { font-weight: bold; margin-bottom: 10px; padding-bottom: 5px; border-bottom: 1px solid #eee; }
        pre { background: #f8f9fa; padding: 10px; border-radius: 4px; overflow-x: auto; font-size: 12px; }
        .file-input { margin: 10px 0; }
        .results { margin: 15px 0; padding: 15px; background: white; border-radius: 5px; border: 1px solid #ddd; }
    </style>
</head>
<body>
    <h1>ğŸ“‹ æª”æ¡ˆè½‰æ›å™¨åŠŸèƒ½å®Œæ•´æ¸¬è©¦</h1>
    
    <div class="test-panel">
        <h2>ğŸš€ ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h2>
        <button class="test-btn" onclick="checkSystemStatus()">æª¢æŸ¥ç³»çµ±ç‹€æ…‹</button>
        <button class="test-btn" onclick="checkLibraryStatus()">æª¢æŸ¥å‡½å¼åº«ç‹€æ…‹</button>
        <button class="test-btn" onclick="initializeConverter()">åˆå§‹åŒ–è½‰æ›å™¨</button>
        
        <div id="systemStatus" class="results"></div>
    </div>

    <div class="test-panel">
        <h2>ğŸ“„ æ–‡æ›¸è½‰æª”æ¸¬è©¦</h2>
        <div class="file-input">
            <label>é¸æ“‡æ–‡æ›¸æª”æ¡ˆï¼š</label>
            <input type="file" id="documentFile" accept=".docx,.doc,.txt,.html,.md,.rtf" />
        </div>
        <button class="test-btn" onclick="testDocumentConversion('txt')">è½‰æ›ç‚º TXT</button>
        <button class="test-btn" onclick="testDocumentConversion('docx')">è½‰æ›ç‚º DOCX</button>
        <button class="test-btn" onclick="testDocumentConversion('pdf')">è½‰æ›ç‚º PDF</button>
        <button class="test-btn" onclick="testDocumentConversion('html')">è½‰æ›ç‚º HTML</button>
        <button class="test-btn" onclick="testDocumentConversion('rtf')">è½‰æ›ç‚º RTF</button>
        
        <div id="documentResults" class="results"></div>
    </div>

    <div class="test-panel">
        <h2>ğŸ“Š è¡¨å–®è½‰æª”æ¸¬è©¦</h2>
        <div class="file-input">
            <label>é¸æ“‡è¡¨å–®æª”æ¡ˆï¼š</label>
            <input type="file" id="spreadsheetFile" accept=".xlsx,.xls,.csv,.tsv" />
        </div>
        <button class="test-btn" onclick="testSpreadsheetConversion('csv')">è½‰æ›ç‚º CSV</button>
        <button class="test-btn" onclick="testSpreadsheetConversion('xlsx')">è½‰æ›ç‚º XLSX</button>
        <button class="test-btn" onclick="testSpreadsheetConversion('json')">è½‰æ›ç‚º JSON</button>
        <button class="test-btn" onclick="testSpreadsheetConversion('html')">è½‰æ›ç‚º HTML</button>
        
        <div id="spreadsheetResults" class="results"></div>
    </div>

    <div class="test-panel">
        <h2>ğŸ¯ ç°¡å ±è½‰æª”æ¸¬è©¦</h2>
        <div class="file-input">
            <label>é¸æ“‡ç°¡å ±æª”æ¡ˆï¼š</label>
            <input type="file" id="presentationFile" accept=".pptx,.ppt,.pdf,.html" />
        </div>
        <button class="test-btn" onclick="testPresentationConversion('pdf')">è½‰æ›ç‚º PDF</button>
        <button class="test-btn" onclick="testPresentationConversion('pptx')">è½‰æ›ç‚º PPTX</button>
        <button class="test-btn" onclick="testPresentationConversion('html')">è½‰æ›ç‚º HTML</button>
        <button class="test-btn" onclick="testPresentationConversion('txt')">è½‰æ›ç‚º TXT</button>
        <button class="test-btn" onclick="testPresentationConversion('md')">è½‰æ›ç‚º MD</button>
        
        <div id="presentationResults" class="results"></div>
    </div>

    <div class="test-panel">
        <h2>ğŸ–¼ï¸ åœ–ç‰‡è½‰æª”æ¸¬è©¦</h2>
        <div class="file-input">
            <label>é¸æ“‡åœ–ç‰‡æª”æ¡ˆï¼š</label>
            <input type="file" id="imageFile" accept="image/*" />
        </div>
        <button class="test-btn" onclick="testImageConversion('png')">è½‰æ›ç‚º PNG</button>
        <button class="test-btn" onclick="testImageConversion('jpg')">è½‰æ›ç‚º JPG</button>
        <button class="test-btn" onclick="testImageConversion('webp')">è½‰æ›ç‚º WebP</button>
        
        <div id="imageResults" class="results"></div>
    </div>

    <!-- Load all necessary scripts -->
    <script src="assets/js/lib-loader.js"></script>
    <script src="assets/js/converters/image.js"></script>
    <script src="assets/js/converters/document.js"></script>
    <script src="assets/js/converters/spreadsheet.js"></script>
    <script src="assets/js/converters/presentation.js"></script>
    <script src="assets/js/app.js"></script>

    <script>
        let testConverter = null;

        function log(message, type = 'info') {
            const className = type === 'success' ? 'success' : type === 'error' ? 'error' : 'info';
            return `<div class="${className}">${new Date().toLocaleTimeString()}: ${message}</div>`;
        }

        async function checkSystemStatus() {
            const statusDiv = document.getElementById('systemStatus');
            let output = '<h3>ç³»çµ±ç‹€æ…‹æª¢æŸ¥</h3>';
            
            // Check if core classes are available
            const coreClasses = {
                'FileConverter': window.FileConverter,
                'LibraryLoader': window.LibraryLoader,
                'DocumentConverter': window.DocumentConverter,
                'SpreadsheetConverter': window.SpreadsheetConverter,
                'PresentationConverter': window.PresentationConverter,
                'ImageConverter': window.ImageConverter
            };
            
            output += '<h4>æ ¸å¿ƒé¡åˆ¥æª¢æŸ¥ï¼š</h4>';
            for (const [name, cls] of Object.entries(coreClasses)) {
                if (cls) {
                    output += log(`âœ… ${name} - å¯ç”¨`, 'success');
                } else {
                    output += log(`âŒ ${name} - ä¸å¯ç”¨`, 'error');
                }
            }
            
            // Check DOM elements
            const elements = ['uploadArea', 'fileInput', 'convertBtn', 'progressSection'];
            output += '<h4>DOM å…ƒç´ æª¢æŸ¥ï¼š</h4>';
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    output += log(`âœ… #${id} - å­˜åœ¨`, 'success');
                } else {
                    output += log(`âŒ #${id} - ä¸å­˜åœ¨`, 'error');
                }
            });
            
            statusDiv.innerHTML = output;
        }

        async function checkLibraryStatus() {
            const statusDiv = document.getElementById('systemStatus');
            let output = '<h3>å‡½å¼åº«ç‹€æ…‹æª¢æŸ¥</h3>';
            
            if (window.libLoader) {
                const status = window.libLoader.getLibraryStatus();
                output += '<h4>ç¬¬ä¸‰æ–¹å‡½å¼åº«ï¼š</h4>';
                
                Object.entries(status).forEach(([name, info]) => {
                    const icon = info.loaded ? 'âœ…' : 'âŒ';
                    const statusText = info.loaded ? 'å·²è¼‰å…¥' : 'æœªè¼‰å…¥';
                    output += log(`${icon} ${name}: ${info.description} - ${statusText}`, info.loaded ? 'success' : 'error');
                });
            } else {
                output += log('âŒ LibraryLoader ä¸å¯ç”¨', 'error');
            }
            
            statusDiv.innerHTML = output;
        }

        async function initializeConverter() {
            const statusDiv = document.getElementById('systemStatus');
            let output = '<h3>åˆå§‹åŒ–è½‰æ›å™¨</h3>';
            
            try {
                if (window.FileConverter) {
                    testConverter = new FileConverter();
                    output += log('âœ… FileConverter åˆå§‹åŒ–æˆåŠŸ', 'success');
                } else {
                    throw new Error('FileConverter é¡åˆ¥ä¸å¯ç”¨');
                }
            } catch (error) {
                output += log(`âŒ åˆå§‹åŒ–å¤±æ•—: ${error.message}`, 'error');
            }
            
            statusDiv.innerHTML = output;
        }

        async function testDocumentConversion(outputFormat) {
            const fileInput = document.getElementById('documentFile');
            const resultsDiv = document.getElementById('documentResults');
            
            if (!fileInput.files.length) {
                resultsDiv.innerHTML = log('âŒ è«‹å…ˆé¸æ“‡ä¸€å€‹æ–‡æ›¸æª”æ¡ˆ', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            let output = `<h4>æ¸¬è©¦æ–‡æ›¸è½‰æª”ï¼š${file.name} â†’ ${outputFormat.toUpperCase()}</h4>`;
            
            try {
                // Extract content
                output += log('ğŸ“– è®€å–æ–‡ä»¶å…§å®¹...', 'info');
                const extractedContent = await DocumentConverter.extractTextContent(file);
                output += log(`âœ… å…§å®¹è®€å–æˆåŠŸï¼Œæ–‡å­—é•·åº¦: ${extractedContent.content.length} å­—å…ƒ`, 'success');
                
                // Convert to format
                output += log(`ğŸ”„ è½‰æ›ç‚º ${outputFormat.toUpperCase()} æ ¼å¼...`, 'info');
                const convertedBlob = await DocumentConverter.convertToFormat(extractedContent, outputFormat);
                output += log(`âœ… è½‰æ›æˆåŠŸï¼Œæª”æ¡ˆå¤§å°: ${convertedBlob.size} bytes`, 'success');
                
                // Create download link
                const url = URL.createObjectURL(convertedBlob);
                const fileName = file.name.replace(/\.[^/.]+$/, '') + '.' + outputFormat;
                output += `<div><a href="${url}" download="${fileName}" style="display: inline-block; padding: 8px 16px; background: #28a745; color: white; text-decoration: none; border-radius: 4px; margin: 10px 0;">ä¸‹è¼‰ ${fileName}</a></div>`;
                
            } catch (error) {
                output += log(`âŒ è½‰æ›å¤±æ•—: ${error.message}`, 'error');
                console.error('æ–‡æ›¸è½‰æª”éŒ¯èª¤:', error);
            }
            
            resultsDiv.innerHTML = output;
        }

        async function testSpreadsheetConversion(outputFormat) {
            const fileInput = document.getElementById('spreadsheetFile');
            const resultsDiv = document.getElementById('spreadsheetResults');
            
            if (!fileInput.files.length) {
                resultsDiv.innerHTML = log('âŒ è«‹å…ˆé¸æ“‡ä¸€å€‹è¡¨å–®æª”æ¡ˆ', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            let output = `<h4>æ¸¬è©¦è¡¨å–®è½‰æª”ï¼š${file.name} â†’ ${outputFormat.toUpperCase()}</h4>`;
            
            try {
                // Parse spreadsheet
                output += log('ğŸ“Š è§£æè¡¨å–®è³‡æ–™...', 'info');
                const parsedData = await SpreadsheetConverter.parseSpreadsheetData(file);
                output += log(`âœ… è§£ææˆåŠŸï¼Œ${parsedData.rowCount} è¡Œ Ã— ${parsedData.columnCount} åˆ—`, 'success');
                
                // Convert to format
                output += log(`ğŸ”„ è½‰æ›ç‚º ${outputFormat.toUpperCase()} æ ¼å¼...`, 'info');
                const convertedBlob = await SpreadsheetConverter.convertToFormat(parsedData, outputFormat);
                output += log(`âœ… è½‰æ›æˆåŠŸï¼Œæª”æ¡ˆå¤§å°: ${convertedBlob.size} bytes`, 'success');
                
                // Create download link
                const url = URL.createObjectURL(convertedBlob);
                const fileName = file.name.replace(/\.[^/.]+$/, '') + '.' + outputFormat;
                output += `<div><a href="${url}" download="${fileName}" style="display: inline-block; padding: 8px 16px; background: #28a745; color: white; text-decoration: none; border-radius: 4px; margin: 10px 0;">ä¸‹è¼‰ ${fileName}</a></div>`;
                
            } catch (error) {
                output += log(`âŒ è½‰æ›å¤±æ•—: ${error.message}`, 'error');
                console.error('è¡¨å–®è½‰æª”éŒ¯èª¤:', error);
            }
            
            resultsDiv.innerHTML = output;
        }

        async function testPresentationConversion(outputFormat) {
            const fileInput = document.getElementById('presentationFile');
            const resultsDiv = document.getElementById('presentationResults');
            
            if (!fileInput.files.length) {
                resultsDiv.innerHTML = log('âŒ è«‹å…ˆé¸æ“‡ä¸€å€‹ç°¡å ±æª”æ¡ˆ', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            let output = `<h4>æ¸¬è©¦ç°¡å ±è½‰æª”ï¼š${file.name} â†’ ${outputFormat.toUpperCase()}</h4>`;
            
            try {
                // Extract presentation content
                output += log('ğŸ¯ è§£æç°¡å ±å…§å®¹...', 'info');
                const presentationData = await PresentationConverter.extractPresentationContent(file);
                output += log(`âœ… è§£ææˆåŠŸï¼Œ${presentationData.slides.length} å¼µæŠ•å½±ç‰‡`, 'success');
                
                // Convert to format
                output += log(`ğŸ”„ è½‰æ›ç‚º ${outputFormat.toUpperCase()} æ ¼å¼...`, 'info');
                const convertedBlob = await PresentationConverter.convertToFormat(presentationData, outputFormat);
                output += log(`âœ… è½‰æ›æˆåŠŸï¼Œæª”æ¡ˆå¤§å°: ${convertedBlob.size} bytes`, 'success');
                
                // Create download link
                const url = URL.createObjectURL(convertedBlob);
                const fileName = file.name.replace(/\.[^/.]+$/, '') + '.' + outputFormat;
                output += `<div><a href="${url}" download="${fileName}" style="display: inline-block; padding: 8px 16px; background: #28a745; color: white; text-decoration: none; border-radius: 4px; margin: 10px 0;">ä¸‹è¼‰ ${fileName}</a></div>`;
                
            } catch (error) {
                output += log(`âŒ è½‰æ›å¤±æ•—: ${error.message}`, 'error');
                console.error('ç°¡å ±è½‰æª”éŒ¯èª¤:', error);
            }
            
            resultsDiv.innerHTML = output;
        }

        async function testImageConversion(outputFormat) {
            const fileInput = document.getElementById('imageFile');
            const resultsDiv = document.getElementById('imageResults');
            
            if (!fileInput.files.length) {
                resultsDiv.innerHTML = log('âŒ è«‹å…ˆé¸æ“‡ä¸€å€‹åœ–ç‰‡æª”æ¡ˆ', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            let output = `<h4>æ¸¬è©¦åœ–ç‰‡è½‰æª”ï¼š${file.name} â†’ ${outputFormat.toUpperCase()}</h4>`;
            
            try {
                // Convert image
                output += log(`ğŸ–¼ï¸ è½‰æ›ç‚º ${outputFormat.toUpperCase()} æ ¼å¼...`, 'info');
                const convertedBlob = await ImageConverter.convertImage(file, outputFormat);
                output += log(`âœ… è½‰æ›æˆåŠŸï¼Œæª”æ¡ˆå¤§å°: ${convertedBlob.size} bytes`, 'success');
                
                // Create download link
                const url = URL.createObjectURL(convertedBlob);
                const fileName = file.name.replace(/\.[^/.]+$/, '') + '.' + outputFormat;
                output += `<div><a href="${url}" download="${fileName}" style="display: inline-block; padding: 8px 16px; background: #28a745; color: white; text-decoration: none; border-radius: 4px; margin: 10px 0;">ä¸‹è¼‰ ${fileName}</a></div>`;
                
            } catch (error) {
                output += log(`âŒ è½‰æ›å¤±æ•—: ${error.message}`, 'error');
                console.error('åœ–ç‰‡è½‰æª”éŒ¯èª¤:', error);
            }
            
            resultsDiv.innerHTML = output;
        }

        // Auto-initialize on page load
        window.addEventListener('load', function() {
            setTimeout(() => {
                checkSystemStatus();
                if (window.libLoader) {
                    checkLibraryStatus();
                }
            }, 1000);
        });
    </script>
</body>
</html>