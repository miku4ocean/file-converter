<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>HTML-Canvas-PDF ä¸­æ–‡æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .btn { padding: 15px 30px; font-size: 16px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 10px; }
        .btn:hover { background: #0056b3; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        
        /* ç”¨æ–¼PDFç”Ÿæˆçš„éš±è—å…§å®¹ */
        .pdf-content {
            position: fixed;
            top: -9999px;
            left: -9999px;
            width: 210mm;
            padding: 20mm;
            background: white;
            font-family: 'Microsoft YaHei', 'PingFang SC', 'Hiragino Sans GB', 'SimSun', sans-serif;
            font-size: 14px;
            line-height: 1.6;
            color: #333;
            box-sizing: border-box;
        }
        
        .pdf-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
            color: #2c3e50;
        }
        
        .pdf-text {
            white-space: pre-wrap;
        }
    </style>
</head>
<body>
    <h1>ğŸ“„ HTML-Canvas-PDF ä¸­æ–‡æ¸¬è©¦</h1>
    <p>ä½¿ç”¨ HTML â†’ Canvas â†’ PDF çš„æ–¹å¼ä¾†ä¿æŒä¸­æ–‡å­—ç¬¦æ­£ç¢ºé¡¯ç¤º</p>
    
    <button class="btn" onclick="testHTMLCanvasPDF()">ğŸš€ ç”Ÿæˆä¸­æ–‡PDF (HTMLæ–¹å¼)</button>
    
    <div id="results"></div>

    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/html2canvas@1.4.1/dist/html2canvas.min.js"></script>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `
                <strong>${new Date().toLocaleTimeString()}</strong> - ${message}
            `;
            document.getElementById('results').appendChild(div);
        }

        async function testHTMLCanvasPDF() {
            log('ğŸ”„ é–‹å§‹ HTML-Canvas-PDF æ¸¬è©¦...');
            
            try {
                // ä¸­æ–‡æ¸¬è©¦å…§å®¹
                const chineseTitle = 'æœ€çµ‚é©—è­‰æ¸¬è©¦æ–‡ä»¶';
                const chineseContent = `é€™æ˜¯ä¸€å€‹ç”¨æ–¼é©—è­‰ PDF è½‰æ›åŠŸèƒ½çš„æ¸¬è©¦æ–‡ä»¶ã€‚

åŠŸèƒ½é©—è­‰é …ç›®ï¼š
â€¢ ä¸­æ–‡å­—ç¬¦æ”¯æ´æ¸¬è©¦
â€¢ ç‰¹æ®Šå­—ç¬¦è™•ç†ï¼š& < > " '
â€¢ å¤šæ®µè½æ ¼å¼é©—è­‰
â€¢ é•·æ–‡æœ¬è™•ç†èƒ½åŠ›æ¸¬è©¦

æ¸¬è©¦æ™‚é–“ï¼š${new Date().toLocaleString()}

é€™å€‹æ¸¬è©¦å°‡é©—è­‰æ˜¯å¦èƒ½å¤ ï¼š
1. ä¿æŒä¸­æ–‡å…§å®¹ä¸è®Š
2. æ­£ç¢ºé¡¯ç¤ºä¸­æ–‡å­—ç¬¦
3. ç¶­æŒæ–‡æœ¬æ ¼å¼å’Œçµæ§‹
4. ç”Ÿæˆå¯è®€çš„ä¸­æ–‡PDFæª”æ¡ˆ

HTML-to-Canvas-to-PDF æ–¹æ³•çš„å„ªé»ï¼š
- ä½¿ç”¨ç€è¦½å™¨åŸç”Ÿä¸­æ–‡å­—é«”æ¸²æŸ“
- ä¿æŒå®Œæ•´çš„æ ¼å¼å’Œæ¨£å¼
- ä¸éœ€è¦è¼‰å…¥å¤–éƒ¨å­—é«”æª”æ¡ˆ
- æ”¯æ´è¤‡é›œçš„ä¸­æ–‡æ’ç‰ˆ`;

                log('ğŸ“ æº–å‚™HTMLå…§å®¹: ' + chineseTitle);
                
                // å‰µå»ºéš±è—çš„HTMLå®¹å™¨ç”¨æ–¼æ¸²æŸ“
                const htmlContent = `
                    <div class="pdf-title">${chineseTitle}</div>
                    <div class="pdf-text">${chineseContent}</div>
                `;
                
                const tempDiv = document.createElement('div');
                tempDiv.className = 'pdf-content';
                tempDiv.innerHTML = htmlContent;
                document.body.appendChild(tempDiv);
                
                log('ğŸ¨ æ­£åœ¨å°‡HTMLè½‰æ›ç‚ºCanvas...');
                
                // ä½¿ç”¨ html2canvas å°‡ HTML è½‰æ›ç‚º Canvas
                const canvas = await html2canvas(tempDiv, {
                    scale: 2, // é«˜è§£æåº¦
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    width: 794,  // A4å¯¬åº¦ (210mm @ 96 DPI)
                    height: 1123 // A4é«˜åº¦ (297mm @ 96 DPI)
                });
                
                log('âœ… Canvas ç”ŸæˆæˆåŠŸ: ' + canvas.width + 'x' + canvas.height);
                
                // æ¸…ç†è‡¨æ™‚å…ƒç´ 
                document.body.removeChild(tempDiv);
                
                // å‰µå»º PDF
                const { jsPDF } = window.jspdf;
                const pdf = new jsPDF({
                    orientation: 'portrait',
                    unit: 'mm',
                    format: 'a4'
                });
                
                log('ğŸ“„ æ­£åœ¨ç”ŸæˆPDF...');
                
                // å°‡ Canvas æ·»åŠ åˆ° PDF
                const imgData = canvas.toDataURL('image/png');
                pdf.addImage(imgData, 'PNG', 0, 0, 210, 297);
                
                // ç”Ÿæˆ PDF Blob
                const pdfBlob = pdf.output('blob');
                
                log('âœ… PDFç”ŸæˆæˆåŠŸ: ' + pdfBlob.size + ' bytes', 'success');
                
                // ä¸‹è¼‰ PDF
                const url = URL.createObjectURL(pdfBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'html-canvas-chinese-pdf.pdf';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                setTimeout(() => URL.revokeObjectURL(url), 1000);
                log('ğŸ“¥ ä¸­æ–‡PDFå·²ä¸‹è¼‰ - æ‡‰è©²èƒ½æ­£ç¢ºé¡¯ç¤ºä¸­æ–‡å­—ç¬¦!', 'success');
                
            } catch (error) {
                log('âŒ éŒ¯èª¤: ' + error.message, 'error');
                console.error('HTML-Canvas-PDF éŒ¯èª¤:', error);
            }
        }

        // æª¢æŸ¥ä¾è³´æ˜¯å¦è¼‰å…¥
        window.addEventListener('load', function() {
            log('ğŸš€ é é¢è¼‰å…¥å®Œæˆ');
            
            setTimeout(() => {
                if (typeof html2canvas !== 'undefined') {
                    log('âœ… html2canvas è¼‰å…¥æˆåŠŸ', 'success');
                } else {
                    log('âŒ html2canvas è¼‰å…¥å¤±æ•—', 'error');
                }
                
                if (typeof window.jspdf !== 'undefined') {
                    log('âœ… jsPDF è¼‰å…¥æˆåŠŸ', 'success');
                } else {
                    log('âŒ jsPDF è¼‰å…¥å¤±æ•—', 'error');
                }
            }, 500);
        });
    </script>
</body>
</html>