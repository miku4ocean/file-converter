<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç°¡å ±è½‰æ›æ¸¬è©¦ (ç„¡ç·©å­˜ç‰ˆæœ¬)</title>
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, sans-serif; margin: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        .upload-area { border: 2px dashed #007bff; padding: 40px; text-align: center; border-radius: 8px; margin: 20px 0; }
        .upload-area.drag-over { background: #e3f2fd; border-color: #1976d2; }
        .file-input { margin: 20px 0; }
        .format-select { margin: 20px 0; }
        .btn { padding: 15px 25px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; font-size: 16px; }
        .btn:hover { background: #0056b3; }
        .btn.success { background: #28a745; }
        .btn.success:hover { background: #218838; }
        .result { margin: 10px 0; padding: 15px; border-radius: 5px; border-left: 4px solid #ddd; }
        .success { background: #d4edda; color: #155724; border-left-color: #28a745; }
        .error { background: #f8d7da; color: #721c24; border-left-color: #dc3545; }
        .info { background: #d1ecf1; color: #0c5460; border-left-color: #17a2b8; }
        .warning { background: #fff3cd; color: #856404; border-left-color: #ffc107; }
        select, input[type="file"] { padding: 10px; border: 1px solid #ddd; border-radius: 5px; font-size: 14px; }
        .download-link { background: #28a745; color: white; text-decoration: none; padding: 10px 20px; border-radius: 5px; display: inline-block; margin: 10px 5px 0 0; }
        .download-link:hover { background: #218838; text-decoration: none; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ“Š ç°¡å ±è½‰æ›æ¸¬è©¦ (ç„¡ç·©å­˜ç‰ˆæœ¬)</h1>
        <p>æ­¤ç‰ˆæœ¬å¼·åˆ¶é‡æ–°è¼‰å…¥æ‰€æœ‰ JavaScript æª”æ¡ˆï¼Œç¢ºä¿ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬</p>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-content">
                <h3>æ‹–æ‹½æª”æ¡ˆåˆ°æ­¤è™•æˆ–é»æ“Šé¸æ“‡</h3>
                <p>æ”¯æ´ PPTXã€PPTã€PDF æ ¼å¼</p>
                <input type="file" id="presentationFile" accept=".pptx,.ppt,.pdf" style="display: none;">
                <button class="btn" onclick="document.getElementById('presentationFile').click()">é¸æ“‡æª”æ¡ˆ</button>
            </div>
        </div>
        
        <div class="format-select">
            <label for="outputFormat"><strong>è¼¸å‡ºæ ¼å¼ï¼š</strong></label>
            <select id="outputFormat">
                <option value="pdf">PDF æ–‡ä»¶</option>
                <option value="html">HTML ç¶²é </option>
                <option value="txt">ç´”æ–‡å­—</option>
            </select>
        </div>
        
        <div style="text-align: center; margin: 30px 0;">
            <button class="btn" onclick="testPresentationConversion()">ğŸš€ é–‹å§‹è½‰æ›</button>
            <button class="btn success" onclick="testWithSampleData()">ğŸ“ ä½¿ç”¨ç¯„ä¾‹è³‡æ–™æ¸¬è©¦</button>
            <button class="btn" onclick="clearResults()" style="background: #6c757d;">ğŸ§¹ æ¸…é™¤çµæœ</button>
        </div>
        
        <div id="results"></div>
    </div>
    
    <!-- å¼·åˆ¶é‡æ–°è¼‰å…¥ JavaScriptï¼Œé¿å…ç·©å­˜å•é¡Œ -->
    <script>
        // æ·»åŠ æ™‚é–“æˆ³é¿å…ç·©å­˜
        const timestamp = new Date().getTime();
        const script = document.createElement('script');
        script.src = `assets/js/converters/presentation.js?v=${timestamp}`;
        script.onload = function() {
            console.log('âœ… PresentationConverter å·²è¼‰å…¥ (ç‰ˆæœ¬:', timestamp, ')');
            
            // æª¢æŸ¥æ–¹æ³•æ˜¯å¦å­˜åœ¨
            if (typeof PresentationConverter !== 'undefined') {
                console.log('âœ… PresentationConverter é¡åˆ¥å¯ç”¨');
                
                const methods = ['convertToPdf', 'convertToHtml', 'convertToText'];
                methods.forEach(method => {
                    if (typeof PresentationConverter[method] === 'function') {
                        console.log(`âœ… ${method} æ–¹æ³•å­˜åœ¨`);
                    } else {
                        console.error(`âŒ ${method} æ–¹æ³•ä¸å­˜åœ¨`);
                    }
                });
            } else {
                console.error('âŒ PresentationConverter é¡åˆ¥æœªè¼‰å…¥');
            }
        };
        script.onerror = function() {
            console.error('âŒ ç„¡æ³•è¼‰å…¥ PresentationConverter');
        };
        document.head.appendChild(script);
    </script>
    
    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            document.getElementById('results').appendChild(div);
            
            // è‡ªå‹•æ»¾å‹•åˆ°çµæœå€åŸŸ
            div.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        // æ‹–æ‹½ä¸Šå‚³åŠŸèƒ½
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('presentationFile');

        uploadArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        });

        uploadArea.addEventListener('dragleave', () => {
            uploadArea.classList.remove('drag-over');
        });

        uploadArea.addEventListener('drop', (e) => {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            if (files.length > 0) {
                fileInput.files = files;
                log(`ğŸ“ å·²é¸æ“‡æª”æ¡ˆ: ${files[0].name}`, 'info');
            }
        });

        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                log(`ğŸ“ å·²é¸æ“‡æª”æ¡ˆ: ${e.target.files[0].name}`, 'info');
            }
        });

        async function testPresentationConversion() {
            clearResults();
            log('ğŸ”„ é–‹å§‹ç°¡å ±è½‰æ›æ¸¬è©¦...', 'info');
            
            const fileInput = document.getElementById('presentationFile');
            const outputFormat = document.getElementById('outputFormat').value;
            const file = fileInput.files[0];
            
            if (!file) {
                log('âŒ è«‹å…ˆé¸æ“‡ç°¡å ±æª”æ¡ˆ', 'error');
                return;
            }
            
            try {
                log(`ğŸ“ æª”æ¡ˆ: ${file.name} (${(file.size/1024/1024).toFixed(2)}MB)`, 'info');
                log(`ğŸ”§ è¼¸å‡ºæ ¼å¼: ${outputFormat.toUpperCase()}`, 'info');
                
                // æª¢æŸ¥ PresentationConverter æ˜¯å¦è¼‰å…¥
                if (typeof PresentationConverter === 'undefined') {
                    log('âŒ PresentationConverter æœªè¼‰å…¥ï¼Œè«‹é‡æ–°æ•´ç†é é¢', 'error');
                    return;
                }
                log('âœ… PresentationConverter è¼‰å…¥æˆåŠŸ', 'success');
                
                // é©—è­‰æª”æ¡ˆæ ¼å¼
                const isValid = PresentationConverter.isValidPresentationFile(file);
                if (!isValid) {
                    log('âŒ ä¸æ”¯æ´çš„æª”æ¡ˆæ ¼å¼', 'error');
                    return;
                }
                log('âœ… æª”æ¡ˆæ ¼å¼é©—è­‰é€šé', 'success');
                
                // æå–ç°¡å ±å…§å®¹
                log('ğŸ” æ­£åœ¨æå–ç°¡å ±å…§å®¹...', 'info');
                const content = await PresentationConverter.extractPresentationContent(file);
                log(`âœ… å…§å®¹æå–æˆåŠŸ: ${content.totalSlides || 1} å¼µæŠ•å½±ç‰‡`, 'success');
                
                // æ ¹æ“šé¸æ“‡çš„æ ¼å¼è½‰æ›
                log(`ğŸ”„ æ­£åœ¨è½‰æ›ç‚º ${outputFormat.toUpperCase()} æ ¼å¼...`, 'info');
                let outputBlob;
                let filename;
                
                const title = file.name.replace(/\.[^/.]+$/, '');
                
                switch (outputFormat) {
                    case 'pdf':
                        log('ğŸ“„ ä½¿ç”¨ HTML-Canvas æ–¹æ³•ç”Ÿæˆ PDF...', 'info');
                        outputBlob = await PresentationConverter.convertToPdf(content, title);
                        filename = `${title}_ç°¡å ±.pdf`;
                        break;
                    case 'html':
                        log('ğŸŒ ç”Ÿæˆ HTML æ ¼å¼...', 'info');
                        outputBlob = PresentationConverter.convertToHtml(content, title);
                        filename = `${title}_ç°¡å ±.html`;
                        break;
                    case 'txt':
                        log('ğŸ“ ç”Ÿæˆç´”æ–‡å­—æ ¼å¼...', 'info');
                        outputBlob = PresentationConverter.convertToText(content, title);
                        filename = `${title}_ç°¡å ±.txt`;
                        break;
                    default:
                        throw new Error('ä¸æ”¯æ´çš„è¼¸å‡ºæ ¼å¼');
                }
                
                if (outputBlob && outputBlob.size > 0) {
                    log(`âœ… ${outputFormat.toUpperCase()} è½‰æ›æˆåŠŸï¼æª”æ¡ˆå¤§å°: ${(outputBlob.size/1024).toFixed(1)} KB`, 'success');
                    
                    // è‡ªå‹•ä¸‹è¼‰
                    const url = URL.createObjectURL(outputBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    setTimeout(() => URL.revokeObjectURL(url), 1000);
                    log(`ğŸ“¥ ${filename} å·²è‡ªå‹•ä¸‹è¼‰`, 'success');
                    
                    // æ·»åŠ ä¸‹è¼‰é€£çµ
                    const results = document.getElementById('results');
                    const linkDiv = document.createElement('div');
                    linkDiv.innerHTML = `
                        <a href="${url}" class="download-link" download="${filename}">
                            ğŸ“„ å†æ¬¡ä¸‹è¼‰ ${filename}
                        </a>
                    `;
                    results.appendChild(linkDiv);
                } else {
                    log('âŒ è½‰æ›å¤±æ•—ï¼šç”¢ç”Ÿç©ºæª”æ¡ˆ', 'error');
                }
                
            } catch (error) {
                log(`âŒ è½‰æ›éŒ¯èª¤: ${error.message}`, 'error');
                console.error('è©³ç´°éŒ¯èª¤:', error);
                
                // æä¾›è©³ç´°çš„éŒ¯èª¤è¨ºæ–·
                if (error.message.includes('convertToFormat')) {
                    log('âš ï¸ é€™æ˜¯èˆŠç‰ˆæœ¬çš„éŒ¯èª¤ï¼Œè«‹å¼·åˆ¶é‡æ–°æ•´ç†é é¢ (Ctrl+F5 æˆ– Cmd+Shift+R)', 'warning');
                }
            }
        }

        async function testWithSampleData() {
            clearResults();
            log('ğŸ”„ é–‹å§‹ç¯„ä¾‹è³‡æ–™æ¸¬è©¦...', 'info');
            
            const outputFormat = document.getElementById('outputFormat').value;
            
            try {
                // å»ºç«‹ç¯„ä¾‹ç°¡å ±è³‡æ–™
                const sampleContent = {
                    title: 'ç¯„ä¾‹ç°¡å ±æ¸¬è©¦',
                    slides: [
                        {
                            slideNumber: 1,
                            title: 'æ­¡è¿æŠ•å½±ç‰‡',
                            content: [
                                'æ­¡è¿ä½¿ç”¨ç°¡å ±è½‰æ›å™¨',
                                'é€™æ˜¯ç¬¬ä¸€å¼µæŠ•å½±ç‰‡',
                                'æ¸¬è©¦ä¸­æ–‡å­—ç¬¦é¡¯ç¤º',
                                'â€¢ é …ç›®ç¬¦è™Ÿæ¸¬è©¦',
                                'â€¢ æ ¼å¼åŒ–æ–‡å­—æ¸¬è©¦',
                                'â€¢ å¤šè¡Œå…§å®¹æ¸¬è©¦'
                            ],
                            notes: 'é€™æ˜¯ç¬¬ä¸€å¼µæŠ•å½±ç‰‡çš„å‚™è¨»'
                        },
                        {
                            slideNumber: 2,
                            title: 'åŠŸèƒ½ä»‹ç´¹',
                            content: [
                                'æ”¯æ´çš„åŠŸèƒ½ï¼š',
                                '1. PowerPoint æª”æ¡ˆè§£æ',
                                '2. PDF æ ¼å¼è¼¸å‡º',
                                '3. HTML æ ¼å¼è¼¸å‡º',
                                '4. ç´”æ–‡å­—æ ¼å¼è¼¸å‡º',
                                '',
                                'ç‰¹è‰²ï¼š',
                                'âœ¨ ä¿æŒä¸­æ–‡å­—ç¬¦',
                                'ğŸ“Š å°ˆæ¥­æ’ç‰ˆ',
                                'ğŸ”§ å¤šæ ¼å¼æ”¯æ´'
                            ],
                            notes: 'åŠŸèƒ½ä»‹ç´¹æŠ•å½±ç‰‡'
                        }
                    ],
                    totalSlides: 2,
                    metadata: {
                        fileType: 'sample',
                        extractedAt: new Date().toISOString(),
                        isValid: true
                    }
                };
                
                log('âœ… ç¯„ä¾‹è³‡æ–™å»ºç«‹æˆåŠŸ', 'success');
                log(`ğŸ“Š åŒ…å« ${sampleContent.totalSlides} å¼µæŠ•å½±ç‰‡`, 'info');
                
                // è½‰æ›
                log(`ğŸ”„ æ­£åœ¨è½‰æ›ç‚º ${outputFormat.toUpperCase()} æ ¼å¼...`, 'info');
                let outputBlob;
                let filename;
                
                const title = 'ç¯„ä¾‹ç°¡å ±æ¸¬è©¦';
                
                switch (outputFormat) {
                    case 'pdf':
                        outputBlob = await PresentationConverter.convertToPdf(sampleContent, title);
                        filename = `${title}.pdf`;
                        break;
                    case 'html':
                        outputBlob = PresentationConverter.convertToHtml(sampleContent, title);
                        filename = `${title}.html`;
                        break;
                    case 'txt':
                        outputBlob = PresentationConverter.convertToText(sampleContent, title);
                        filename = `${title}.txt`;
                        break;
                }
                
                if (outputBlob && outputBlob.size > 0) {
                    log(`âœ… ç¯„ä¾‹ ${outputFormat.toUpperCase()} è½‰æ›æˆåŠŸï¼æª”æ¡ˆå¤§å°: ${(outputBlob.size/1024).toFixed(1)} KB`, 'success');
                    
                    // è‡ªå‹•ä¸‹è¼‰
                    const url = URL.createObjectURL(outputBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = filename;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    
                    setTimeout(() => URL.revokeObjectURL(url), 1000);
                    log(`ğŸ“¥ ${filename} å·²è‡ªå‹•ä¸‹è¼‰`, 'success');
                } else {
                    log('âŒ ç¯„ä¾‹è½‰æ›å¤±æ•—ï¼šç”¢ç”Ÿç©ºæª”æ¡ˆ', 'error');
                }
                
            } catch (error) {
                log(`âŒ ç¯„ä¾‹è½‰æ›éŒ¯èª¤: ${error.message}`, 'error');
                console.error('è©³ç´°éŒ¯èª¤:', error);
            }
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œé¡¯ç¤ºç‹€æ…‹
        window.addEventListener('load', function() {
            setTimeout(() => {
                log('ğŸš€ ç„¡ç·©å­˜ç‰ˆæœ¬é é¢è¼‰å…¥å®Œæˆ', 'success');
                log('ğŸ“ æ­¤ç‰ˆæœ¬æœƒå¼·åˆ¶è¼‰å…¥æœ€æ–°çš„ JavaScript æª”æ¡ˆ', 'info');
                
                if (typeof PresentationConverter !== 'undefined') {
                    log('âœ… PresentationConverter è¼‰å…¥æˆåŠŸ', 'success');
                } else {
                    log('â³ PresentationConverter è¼‰å…¥ä¸­...', 'warning');
                }
            }, 1000);
        });
    </script>
</body>
</html>