<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è½‰æ›å™¨åŠŸèƒ½è¨ºæ–·</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { border: 1px solid #ccc; margin: 15px 0; padding: 20px; border-radius: 8px; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 15px; margin: 5px; cursor: pointer; }
        input[type="file"] { margin: 10px 0; }
    </style>
</head>
<body>
    <h1>ğŸ”§ è½‰æ›å™¨åŠŸèƒ½è¨ºæ–·</h1>
    
    <div class="test-section">
        <h3>ğŸ“‹ è½‰æ›å™¨è¼‰å…¥ç‹€æ…‹</h3>
        <div id="loadStatus"></div>
        <button onclick="checkConverters()">æª¢æŸ¥è½‰æ›å™¨</button>
    </div>

    <div class="test-section">
        <h3>ğŸ“„ æ–‡æ›¸è½‰æª”æ¸¬è©¦</h3>
        <input type="file" id="documentFile" accept=".docx,.doc,.txt,.html,.md">
        <button onclick="testDocumentUpload()">æ¸¬è©¦æ–‡æ›¸ä¸Šå‚³</button>
        <button onclick="testPDFConversion()">æ¸¬è©¦ PDF è½‰æ›</button>
        <div id="documentResult"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ¯ ç°¡å ±è½‰æª”æ¸¬è©¦</h3>
        <input type="file" id="presentationFile" accept=".pptx,.ppt,.pdf">
        <button onclick="testPresentationUpload()">æ¸¬è©¦ç°¡å ±ä¸Šå‚³</button>
        <div id="presentationResult"></div>
    </div>

    <div class="test-section">
        <h3>ğŸ“Š è¡¨å–®è½‰æª”æ¸¬è©¦</h3>
        <input type="file" id="spreadsheetFile" accept=".xlsx,.csv">
        <button onclick="testSpreadsheetUpload()">æ¸¬è©¦è¡¨å–®ä¸Šå‚³</button>
        <div id="spreadsheetResult"></div>
    </div>

    <!-- è¼‰å…¥æ‰€æœ‰è½‰æ›å™¨ -->
    <script src="assets/js/converters/document.js"></script>
    <script src="assets/js/converters/presentation.js"></script>
    <script src="assets/js/converters/spreadsheet.js"></script>
    <script src="assets/js/lib-loader.js"></script>

    <script>
        function logResult(elementId, success, message) {
            const element = document.getElementById(elementId);
            const resultDiv = document.createElement('div');
            resultDiv.className = `result ${success ? 'success' : 'error'}`;
            resultDiv.innerHTML = `${success ? 'âœ…' : 'âŒ'} ${message}`;
            element.appendChild(resultDiv);
        }

        function checkConverters() {
            const statusDiv = document.getElementById('loadStatus');
            statusDiv.innerHTML = '';

            // æª¢æŸ¥å„å€‹è½‰æ›å™¨æ˜¯å¦è¼‰å…¥
            const converters = [
                { name: 'DocumentConverter', obj: window.DocumentConverter },
                { name: 'PresentationConverter', obj: window.PresentationConverter },
                { name: 'SpreadsheetConverter', obj: window.SpreadsheetConverter }
            ];

            converters.forEach(converter => {
                if (converter.obj) {
                    logResult('loadStatus', true, `${converter.name} å·²è¼‰å…¥`);
                    
                    // æª¢æŸ¥é—œéµæ–¹æ³•
                    const methods = ['isValidDocumentFile', 'isValidPresentationFile', 'isValidSpreadsheetFile'];
                    const relevantMethod = methods.find(method => 
                        typeof converter.obj[method] === 'function'
                    );
                    
                    if (relevantMethod) {
                        logResult('loadStatus', true, `${converter.name}.${relevantMethod} æ–¹æ³•å¯ç”¨`);
                    }
                } else {
                    logResult('loadStatus', false, `${converter.name} æœªè¼‰å…¥`);
                }
            });

            // æª¢æŸ¥ PDF è½‰æ›æ–¹æ³•
            if (window.DocumentConverter && typeof window.DocumentConverter.convertToPdf === 'function') {
                logResult('loadStatus', true, 'PDF è½‰æ›æ–¹æ³•å·²å¯¦ç¾');
            } else {
                logResult('loadStatus', false, 'PDF è½‰æ›æ–¹æ³•ç¼ºå¤±');
            }
        }

        function testDocumentUpload() {
            const fileInput = document.getElementById('documentFile');
            const file = fileInput.files[0];
            
            if (!file) {
                logResult('documentResult', false, 'è«‹å…ˆé¸æ“‡æª”æ¡ˆ');
                return;
            }

            document.getElementById('documentResult').innerHTML = '';

            try {
                if (window.DocumentConverter) {
                    const isValid = DocumentConverter.isValidDocumentFile(file);
                    logResult('documentResult', isValid, 
                        `æª”æ¡ˆé©—è­‰: ${file.name} (${file.type}) - ${isValid ? 'æœ‰æ•ˆ' : 'ç„¡æ•ˆ'}`);
                    
                    if (isValid) {
                        logResult('documentResult', true, `æª”æ¡ˆå¤§å°: ${(file.size/1024).toFixed(2)} KB`);
                    }
                } else {
                    logResult('documentResult', false, 'DocumentConverter æœªè¼‰å…¥');
                }
            } catch (error) {
                logResult('documentResult', false, `æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testPDFConversion() {
            try {
                document.getElementById('documentResult').innerHTML = '';
                
                if (!window.DocumentConverter || typeof DocumentConverter.convertToPdf !== 'function') {
                    logResult('documentResult', false, 'PDF è½‰æ›åŠŸèƒ½ä¸å¯ç”¨');
                    return;
                }

                const testContent = "æ¸¬è©¦ PDF è½‰æ›åŠŸèƒ½\n\né€™æ˜¯ä¸€å€‹æ¸¬è©¦æ–‡ä»¶ï¼Œç”¨ä¾†é©—è­‰ PDF è½‰æ›æ˜¯å¦æ­£å¸¸å·¥ä½œã€‚\n\nåŒ…å«ä¸­æ–‡å­—ç¬¦æ¸¬è©¦ã€‚";
                const testTitle = "PDF æ¸¬è©¦æ–‡ä»¶";

                logResult('documentResult', true, 'é–‹å§‹ PDF è½‰æ›æ¸¬è©¦...');
                
                const pdfBlob = await DocumentConverter.convertToPdf(testContent, testTitle);
                
                if (pdfBlob && pdfBlob.size > 0) {
                    logResult('documentResult', true, `PDF è½‰æ›æˆåŠŸï¼æª”æ¡ˆå¤§å°: ${pdfBlob.size} bytes`);
                    
                    // è‡ªå‹•ä¸‹è¼‰æ¸¬è©¦
                    const url = URL.createObjectURL(pdfBlob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = 'test-conversion.pdf';
                    a.click();
                    setTimeout(() => URL.revokeObjectURL(url), 1000);
                    
                    logResult('documentResult', true, 'PDF å·²è‡ªå‹•ä¸‹è¼‰');
                } else {
                    logResult('documentResult', false, 'PDF è½‰æ›å¤±æ•—ï¼šç”¢ç”Ÿç©ºæª”æ¡ˆ');
                }
            } catch (error) {
                logResult('documentResult', false, `PDF è½‰æ›éŒ¯èª¤: ${error.message}`);
                console.error('PDF conversion error:', error);
            }
        }

        function testPresentationUpload() {
            const fileInput = document.getElementById('presentationFile');
            const file = fileInput.files[0];
            
            if (!file) {
                logResult('presentationResult', false, 'è«‹å…ˆé¸æ“‡æª”æ¡ˆ');
                return;
            }

            document.getElementById('presentationResult').innerHTML = '';

            try {
                if (window.PresentationConverter) {
                    const isValid = PresentationConverter.isValidPresentationFile(file);
                    logResult('presentationResult', isValid, 
                        `æª”æ¡ˆé©—è­‰: ${file.name} (${file.type}) - ${isValid ? 'æœ‰æ•ˆ' : 'ç„¡æ•ˆ'}`);
                    
                    if (isValid) {
                        logResult('presentationResult', true, `æª”æ¡ˆå¤§å°: ${(file.size/1024).toFixed(2)} KB`);
                        
                        // å˜—è©¦æå–å…§å®¹
                        testPresentationExtraction(file);
                    }
                } else {
                    logResult('presentationResult', false, 'PresentationConverter æœªè¼‰å…¥');
                }
            } catch (error) {
                logResult('presentationResult', false, `æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        async function testPresentationExtraction(file) {
            try {
                logResult('presentationResult', true, 'å˜—è©¦æå–ç°¡å ±å…§å®¹...');
                
                const content = await PresentationConverter.extractPresentationContent(file);
                
                if (content && content.slides && content.slides.length > 0) {
                    logResult('presentationResult', true, `æˆåŠŸæå– ${content.slides.length} å¼µæŠ•å½±ç‰‡`);
                } else {
                    logResult('presentationResult', false, 'ç„¡æ³•æå–ç°¡å ±å…§å®¹');
                }
            } catch (error) {
                logResult('presentationResult', false, `å…§å®¹æå–å¤±æ•—: ${error.message}`);
                console.error('Presentation extraction error:', error);
            }
        }

        function testSpreadsheetUpload() {
            const fileInput = document.getElementById('spreadsheetFile');
            const file = fileInput.files[0];
            
            if (!file) {
                logResult('spreadsheetResult', false, 'è«‹å…ˆé¸æ“‡æª”æ¡ˆ');
                return;
            }

            document.getElementById('spreadsheetResult').innerHTML = '';

            try {
                if (window.SpreadsheetConverter) {
                    const isValid = SpreadsheetConverter.isValidSpreadsheetFile(file);
                    logResult('spreadsheetResult', isValid, 
                        `æª”æ¡ˆé©—è­‰: ${file.name} (${file.type}) - ${isValid ? 'æœ‰æ•ˆ' : 'ç„¡æ•ˆ'}`);
                    
                    if (isValid) {
                        logResult('spreadsheetResult', true, `æª”æ¡ˆå¤§å°: ${(file.size/1024).toFixed(2)} KB`);
                    }
                } else {
                    logResult('spreadsheetResult', false, 'SpreadsheetConverter æœªè¼‰å…¥');
                }
            } catch (error) {
                logResult('spreadsheetResult', false, `æ¸¬è©¦å¤±æ•—: ${error.message}`);
            }
        }

        // é é¢è¼‰å…¥æ™‚è‡ªå‹•æª¢æŸ¥
        window.addEventListener('load', function() {
            setTimeout(checkConverters, 500);
        });
    </script>
</body>
</html>