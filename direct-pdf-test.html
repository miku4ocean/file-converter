<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ–¨ï¸ ç›´æ¥PDFè½‰æ›æ¸¬è©¦</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; padding: 20px; background: #f5f5f5; }
        .container { max-width: 800px; margin: 0 auto; background: white; padding: 30px; border-radius: 10px; }
        .test-section { margin: 30px 0; padding: 20px; border: 1px solid #ddd; border-radius: 8px; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 5px; cursor: pointer; color: white; }
        .btn-primary { background: #3498db; }
        .btn-success { background: #2ecc71; }
        .btn-warning { background: #f39c12; }
        .status { margin: 15px 0; padding: 15px; border-radius: 5px; }
        .status.success { background: #d4edda; border: 1px solid #c3e6cb; color: #155724; }
        .status.error { background: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; }
        .status.info { background: #d1ecf1; border: 1px solid #bee5eb; color: #0c5460; }
        .progress { height: 6px; background: #e9ecef; border-radius: 3px; margin: 10px 0; }
        .progress-bar { height: 100%; background: #28a745; border-radius: 3px; transition: width 0.3s; }
        .file-input { margin: 15px 0; padding: 15px; border: 2px dashed #ccc; text-align: center; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¨ï¸ ç›´æ¥PDFè½‰æ›æ¸¬è©¦</h1>
        <p>æ¸¬è©¦æ–°çš„ç›´æ¥PDFè½‰æ›åŠŸèƒ½ï¼Œä¿ç•™åŸå§‹æª”æ¡ˆå¤–è§€</p>

        <div class="test-section">
            <h2>HTMLæ–‡ä»¶è½‰PDF</h2>
            <div class="file-input">
                <input type="file" id="htmlFile" accept=".html,.htm">
                <p>é¸æ“‡HTMLæª”æ¡ˆ</p>
            </div>
            <button class="btn btn-primary" onclick="testHTMLToPDF()">è½‰æ›HTMLç‚ºPDF</button>
            <button class="btn btn-warning" onclick="createSampleHTML()">å»ºç«‹ç¯„ä¾‹HTML</button>
            <div id="htmlStatus" class="status" style="display:none;"></div>
            <div id="htmlProgress" class="progress" style="display:none;">
                <div class="progress-bar" style="width:0%"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>æ–‡æ›¸æª”æ¡ˆè½‰PDF</h2>
            <div class="file-input">
                <input type="file" id="documentFile" accept=".docx,.doc,.txt,.md,.rtf">
                <p>é¸æ“‡æ–‡æ›¸æª”æ¡ˆ</p>
            </div>
            <button class="btn btn-primary" onclick="testDocumentToPDF()">è½‰æ›æ–‡æ›¸ç‚ºPDF</button>
            <button class="btn btn-success" onclick="testTextFile()">å»ºç«‹æ¸¬è©¦æ–‡å­—æª”</button>
            <div id="documentStatus" class="status" style="display:none;"></div>
            <div id="documentProgress" class="progress" style="display:none;">
                <div class="progress-bar" style="width:0%"></div>
            </div>
        </div>

        <div class="test-section">
            <h2>æ¸¬è©¦çµæœ</h2>
            <div id="testResults">é»æ“Šä¸Šé¢çš„æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</div>
        </div>
    </div>

    <script src="assets/js/converters/direct-pdf.js"></script>
    <script>
        let testResults = [];

        function showStatus(elementId, message, type = 'info') {
            const statusEl = document.getElementById(elementId);
            statusEl.style.display = 'block';
            statusEl.textContent = message;
            statusEl.className = `status ${type}`;
        }

        function updateProgress(elementId, percent) {
            const progressEl = document.getElementById(elementId);
            const progressBar = progressEl.querySelector('.progress-bar');
            progressEl.style.display = 'block';
            progressBar.style.width = percent + '%';
        }

        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function addTestResult(test, success, details) {
            testResults.push({
                test, success, details,
                timestamp: new Date().toLocaleString()
            });
            updateTestResults();
        }

        function updateTestResults() {
            const resultsEl = document.getElementById('testResults');
            if (testResults.length === 0) {
                resultsEl.innerHTML = 'é»æ“Šä¸Šé¢çš„æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...';
                return;
            }
            resultsEl.innerHTML = testResults.map(result => `
                <div class="status ${result.success ? 'success' : 'error'}">
                    <strong>${result.success ? 'âœ…' : 'âŒ'} ${result.test}</strong><br>
                    <small>${result.timestamp}</small><br>
                    ${result.details}
                </div>
            `).join('');
        }

        async function testHTMLToPDF() {
            const fileInput = document.getElementById('htmlFile');
            if (fileInput.files.length === 0) {
                showStatus('htmlStatus', 'è«‹å…ˆé¸æ“‡HTMLæª”æ¡ˆ', 'error');
                return;
            }

            const file = fileInput.files[0];
            try {
                showStatus('htmlStatus', 'æ­£åœ¨è½‰æ›...', 'info');
                updateProgress('htmlProgress', 30);

                const pdfBlob = await DirectPDFConverter.convertToPDF(file);
                
                updateProgress('htmlProgress', 100);
                showStatus('htmlStatus', 'è½‰æ›æˆåŠŸï¼', 'success');

                downloadBlob(pdfBlob, file.name.replace(/\\.[^.]+$/, '') + '_direct.pdf');
                addTestResult('HTMLè½‰PDF', true, `æª”æ¡ˆ: ${file.name}, å¤§å°: ${(pdfBlob.size/1024).toFixed(2)}KB`);

            } catch (error) {
                console.error('HTMLè½‰PDFå¤±æ•—:', error);
                showStatus('htmlStatus', 'è½‰æ›å¤±æ•—: ' + error.message, 'error');
                addTestResult('HTMLè½‰PDF', false, error.message);
            }
        }

        function createSampleHTML() {
            const htmlContent = \`<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç¯„ä¾‹æ–‡ä»¶</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; line-height: 1.6; }
        h1 { color: #2c3e50; border-bottom: 2px solid #3498db; padding-bottom: 10px; }
        h2 { color: #27ae60; }
        .highlight { background: #fff3cd; padding: 15px; border-left: 4px solid #ffc107; margin: 20px 0; }
    </style>
</head>
<body>
    <h1>ğŸ“Š æ¸¬è©¦æ–‡ä»¶</h1>
    <h2>ç¬¬ä¸€ç« </h2>
    <p>é€™æ˜¯ä¸€å€‹æ¸¬è©¦HTMLæ–‡ä»¶ï¼Œç”¨ä¾†å±•ç¤ºç›´æ¥PDFè½‰æ›åŠŸèƒ½ã€‚</p>
    <div class="highlight">
        <strong>é‡é»ï¼š</strong> é€™æœƒä¿ç•™æ‰€æœ‰CSSæ¨£å¼å’Œä½ˆå±€ï¼
    </div>
    <h2>ç¬¬äºŒç« </h2>
    <ul>
        <li>å®Œæ•´ä¿ç•™è¦–è¦ºå¤–è§€</li>
        <li>æ”¯æ´è¤‡é›œCSSæ¨£å¼</li>
        <li>é¡ä¼¼ç€è¦½å™¨åˆ—å°åŠŸèƒ½</li>
    </ul>
</body>
</html>\`;

            const blob = new Blob([htmlContent], { type: 'text/html' });
            const file = new File([blob], 'sample.html', { type: 'text/html' });
            
            const fileInput = document.getElementById('htmlFile');
            const dt = new DataTransfer();
            dt.items.add(file);
            fileInput.files = dt.files;
            
            showStatus('htmlStatus', 'å·²å»ºç«‹ç¯„ä¾‹HTMLæª”æ¡ˆ', 'success');
        }

        async function testDocumentToPDF() {
            const fileInput = document.getElementById('documentFile');
            if (fileInput.files.length === 0) {
                showStatus('documentStatus', 'è«‹å…ˆé¸æ“‡æ–‡æ›¸æª”æ¡ˆ', 'error');
                return;
            }

            const file = fileInput.files[0];
            try {
                showStatus('documentStatus', 'æ­£åœ¨è½‰æ›...', 'info');
                updateProgress('documentProgress', 30);

                const pdfBlob = await DirectPDFConverter.convertToPDF(file);
                
                updateProgress('documentProgress', 100);
                showStatus('documentStatus', 'è½‰æ›æˆåŠŸï¼', 'success');

                downloadBlob(pdfBlob, file.name.replace(/\\.[^.]+$/, '') + '_direct.pdf');
                addTestResult('æ–‡æ›¸è½‰PDF', true, `æª”æ¡ˆ: ${file.name}, å¤§å°: ${(pdfBlob.size/1024).toFixed(2)}KB`);

            } catch (error) {
                console.error('æ–‡æ›¸è½‰PDFå¤±æ•—:', error);
                showStatus('documentStatus', 'è½‰æ›å¤±æ•—: ' + error.message, 'error');
                addTestResult('æ–‡æ›¸è½‰PDF', false, error.message);
            }
        }

        function testTextFile() {
            const textContent = \`æ¸¬è©¦æ–‡å­—æª”æ¡ˆ

é€™æ˜¯ç¬¬ä¸€æ®µå…§å®¹ï¼Œç”¨ä¾†æ¸¬è©¦ç›´æ¥PDFè½‰æ›ã€‚

ç¬¬äºŒæ®µï¼šæ–°çš„è½‰æ›æ–¹å¼æœƒä¿ç•™æ–‡å­—æ ¼å¼ï¼Œ
åŒ…æ‹¬æ›è¡Œå’Œæ®µè½çµæ§‹ã€‚

æ¸¬è©¦é …ç›®ï¼š
â€¢ ä¸­æ–‡å­—ç¬¦æ”¯æ´
â€¢ æ®µè½æ ¼å¼ä¿ç•™  
â€¢ æ›è¡Œè™•ç†

é€™æ˜¯çœŸæ­£çš„æª”æ¡ˆè½‰æ›ï¼Œä¸æ˜¯å…§å®¹æ‘˜è¦ï¼

ç”Ÿæˆæ™‚é–“ï¼š\${new Date().toLocaleString()}\`;

            const blob = new Blob([textContent], { type: 'text/plain' });
            const file = new File([blob], 'test.txt', { type: 'text/plain' });
            
            const fileInput = document.getElementById('documentFile');
            const dt = new DataTransfer();
            dt.items.add(file);
            fileInput.files = dt.files;
            
            showStatus('documentStatus', 'å·²å»ºç«‹æ¸¬è©¦æ–‡å­—æª”', 'success');
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('ç›´æ¥PDFè½‰æ›æ¸¬è©¦é é¢è¼‰å…¥');
            if (typeof DirectPDFConverter === 'undefined') {
                document.body.innerHTML = '<div style="text-align:center;padding:50px;color:red;"><h1>è½‰æ›å™¨è¼‰å…¥å¤±æ•—</h1></div>';
            }
        });
    </script>
</body>
</html>