<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨é¢ PDF è½‰æª”æ¸¬è©¦</title>
    <style>
        * { box-sizing: border-box; }
        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            margin: 0; padding: 20px; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #333;
        }
        .container {
            max-width: 1200px; margin: 0 auto;
            background: white; border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden;
        }
        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white; padding: 30px; text-align: center;
        }
        .header h1 { margin: 0; font-size: 2.5em; }
        .header p { margin: 10px 0 0; opacity: 0.9; }
        
        .test-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            padding: 20px;
        }
        
        .test-card {
            background: #f8f9fa;
            border: 1px solid #e9ecef;
            border-radius: 10px;
            padding: 20px;
            transition: all 0.3s ease;
        }
        .test-card:hover { box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .test-card h3 {
            color: #495057;
            margin: 0 0 15px;
            display: flex;
            align-items: center;
        }
        .test-card h3 .icon {
            font-size: 1.5em;
            margin-right: 10px;
        }
        
        .full-width {
            grid-column: 1 / -1;
        }
        
        .console {
            background: #1e1e1e;
            color: #00ff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            border: 2px solid #333;
        }
        .console .timestamp { color: #888; }
        .console .error { color: #ff4444; }
        .console .success { color: #44ff44; }
        .console .warning { color: #ffaa44; }
        .console .info { color: #4444ff; }
        
        .status-indicator {
            display: inline-block;
            width: 12px; height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        .status-pending { background: #ffc107; }
        .status-running { background: #007bff; animation: pulse 1s infinite; }
        .status-success { background: #28a745; }
        .status-error { background: #dc3545; }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white; border: none; padding: 12px 24px;
            border-radius: 25px; cursor: pointer;
            font-weight: bold; margin: 5px;
            transition: all 0.3s ease;
        }
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        .btn:disabled {
            background: #ccc; cursor: not-allowed;
            transform: none; box-shadow: none;
        }
        
        .progress-container {
            background: #e9ecef;
            border-radius: 10px;
            height: 8px;
            overflow: hidden;
            margin: 15px 0;
        }
        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            width: 0%;
            transition: width 0.5s ease;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        .stat-box {
            background: white;
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        .stat-number {
            font-size: 2em;
            font-weight: bold;
            color: #667eea;
        }
        .stat-label {
            color: #666;
            font-size: 0.9em;
        }
        
        .result-display {
            background: #f8f9fa;
            border-left: 4px solid #007bff;
            padding: 15px;
            margin: 10px 0;
            border-radius: 0 8px 8px 0;
        }
        
        @media (max-width: 768px) {
            .test-grid { grid-template-columns: 1fr; }
            .header h1 { font-size: 2em; }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ§ª å…¨é¢ PDF è½‰æª”æ¸¬è©¦</h1>
            <p>æ·±åº¦æ¸¬è©¦æ‰€æœ‰ PDF è½‰æª”åŠŸèƒ½å’Œä¿®å¾©æ•ˆæœ</p>
        </div>
        
        <div class="test-grid">
            <!-- æ§åˆ¶é¢æ¿ -->
            <div class="test-card full-width">
                <h3><span class="icon">ğŸ®</span>æ§åˆ¶é¢æ¿</h3>
                <button class="btn" onclick="runComprehensiveTest()" id="startBtn">ğŸš€ é–‹å§‹å…¨é¢æ¸¬è©¦</button>
                <button class="btn" onclick="runQuickTest()" id="quickBtn">âš¡ å¿«é€Ÿæ¸¬è©¦</button>
                <button class="btn" onclick="clearAllResults()" id="clearBtn">ğŸ§¹ æ¸…é™¤æ‰€æœ‰çµæœ</button>
                <button class="btn" onclick="downloadTestReport()" id="reportBtn">ğŸ“Š ä¸‹è¼‰æ¸¬è©¦å ±å‘Š</button>
                
                <div class="progress-container">
                    <div class="progress-bar" id="overallProgress"></div>
                </div>
                <div id="progressText">æº–å‚™é–‹å§‹æ¸¬è©¦...</div>
            </div>
            
            <!-- çµ±è¨ˆæ•¸æ“š -->
            <div class="test-card">
                <h3><span class="icon">ğŸ“Š</span>æ¸¬è©¦çµ±è¨ˆ</h3>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-number" id="totalTests">0</div>
                        <div class="stat-label">ç¸½æ¸¬è©¦æ•¸</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="passedTests">0</div>
                        <div class="stat-label">é€šéæ¸¬è©¦</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="failedTests">0</div>
                        <div class="stat-label">å¤±æ•—æ¸¬è©¦</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="successRate">0%</div>
                        <div class="stat-label">æˆåŠŸç‡</div>
                    </div>
                </div>
            </div>
            
            <!-- å³æ™‚ç›£æ§ -->
            <div class="test-card">
                <h3><span class="icon">ğŸ“º</span>å³æ™‚ç›£æ§</h3>
                <div id="currentTest">
                    <span class="status-indicator status-pending"></span>ç­‰å¾…é–‹å§‹æ¸¬è©¦
                </div>
                <div class="result-display">
                    <div id="testStatus">ç³»çµ±æº–å‚™å°±ç·’</div>
                    <div id="lastResult"></div>
                </div>
            </div>
            
            <!-- æ§åˆ¶å°è¼¸å‡º -->
            <div class="test-card full-width">
                <h3><span class="icon">ğŸ’»</span>è©³ç´°æ—¥èªŒ</h3>
                <div class="console" id="console"></div>
                <button class="btn" onclick="clearConsole()">æ¸…é™¤æ—¥èªŒ</button>
                <button class="btn" onclick="exportLogs()">åŒ¯å‡ºæ—¥èªŒ</button>
            </div>
        </div>
    </div>

    <script src="assets/js/lib-loader.js"></script>
    <script>
        let documentConverter;
        let testResults = [];
        let currentTestIndex = 0;
        let isTestingInProgress = false;
        
        // æ¸¬è©¦æ¡ˆä¾‹å®šç¾©
        const testCases = [
            {
                name: "åŸºæœ¬æ–‡å­—è½‰ PDF",
                type: "text",
                content: "Hello World!\né€™æ˜¯åŸºæœ¬æ–‡å­—æ¸¬è©¦ã€‚",
                filename: "basic-test.pdf"
            },
            {
                name: "ç‰¹æ®Šå­—ç¬¦è½‰ PDF", 
                type: "text",
                content: "ç‰¹æ®Šå­—ç¬¦æ¸¬è©¦ï¼š& < > \" '\nHTML å¯¦é«”ï¼š&amp; &lt; &gt; &quot; &#39;",
                filename: "special-chars.pdf"
            },
            {
                name: "ä¸­æ–‡é•·æ–‡è½‰ PDF",
                type: "text", 
                content: "ä¸­æ–‡æ¸¬è©¦æ®µè½\n\né€™æ˜¯ä¸€å€‹åŒ…å«å¤šå€‹æ®µè½çš„ä¸­æ–‡æ–‡ä»¶ï¼Œç”¨ä¾†æ¸¬è©¦ PDF è½‰æª”åœ¨è™•ç†ä¸­æ–‡å­—ç¬¦æ™‚çš„è¡¨ç¾ã€‚æ–‡ä»¶åŒ…å«å¤šå€‹æ®µè½ï¼Œæ¯å€‹æ®µè½éƒ½æœ‰ä¸åŒçš„å…§å®¹å’Œé•·åº¦ã€‚\n\nç¬¬äºŒæ®µè½åŒ…å«æ›´å¤šæ–‡å­—ï¼Œç¢ºä¿è½‰æª”ç³»çµ±èƒ½å¤ æ­£ç¢ºè™•ç†è¼ƒé•·çš„æ–‡å­—å…§å®¹ï¼Œä¸¦ä¸”ä¿æŒé©ç•¶çš„æ ¼å¼å’Œæ’ç‰ˆã€‚",
                filename: "chinese-long.pdf"
            },
            {
                name: "å¤šèªè¨€æ··åˆè½‰ PDF",
                type: "text",
                content: "å¤šèªè¨€æ¸¬è©¦ï¼š\nEnglish: Hello World!\nä¸­æ–‡ï¼šä½ å¥½ä¸–ç•Œï¼\næ—¥æ–‡ï¼šã“ã‚“ã«ã¡ã¯ä¸–ç•Œï¼\néŸ“æ–‡ï¼šì•ˆë…•í•˜ì„¸ìš” ì„¸ê³„!\nEmoji: ğŸŒğŸš€âœ¨",
                filename: "multilang.pdf"
            },
            {
                name: "ç©ºå…§å®¹è™•ç†æ¸¬è©¦",
                type: "text", 
                content: "",
                filename: "empty-content.pdf"
            },
            {
                name: "è¶…é•·æ–‡å­—æ¸¬è©¦",
                type: "text",
                content: "é€™æ˜¯ä¸€å€‹è¶…é•·çš„æ–‡å­—æ¸¬è©¦ã€‚".repeat(100) + "\n\n" + "é‡è¤‡æ®µè½æ¸¬è©¦ã€‚".repeat(50),
                filename: "very-long.pdf"
            }
        ];
        
        // ç­‰å¾…å‡½å¼åº«è¼‰å…¥
        window.addEventListener('librariesLoaded', function() {
            log('âœ… å‡½å¼åº«è¼‰å…¥å®Œæˆ', 'success');
            documentConverter = new DocumentConverter();
            updateStatus('ç³»çµ±æº–å‚™å°±ç·’ï¼Œå¯ä»¥é–‹å§‹æ¸¬è©¦');
        });
        
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.innerHTML = `<span class="timestamp">[${timestamp}]</span> <span class="${type}">${message}</span>`;
            console.appendChild(logEntry);
            console.scrollTop = console.scrollHeight;
        }
        
        function updateProgress(percent, text) {
            document.getElementById('overallProgress').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }
        
        function updateStatus(message, indicator = 'pending') {
            const currentTest = document.getElementById('currentTest');
            const statusIndicator = currentTest.querySelector('.status-indicator');
            statusIndicator.className = `status-indicator status-${indicator}`;
            currentTest.innerHTML = `<span class="status-indicator status-${indicator}"></span>${message}`;
        }
        
        function updateStats() {
            const total = testResults.length;
            const passed = testResults.filter(r => r.success).length;
            const failed = total - passed;
            const rate = total > 0 ? Math.round((passed / total) * 100) : 0;
            
            document.getElementById('totalTests').textContent = total;
            document.getElementById('passedTests').textContent = passed;
            document.getElementById('failedTests').textContent = failed;
            document.getElementById('successRate').textContent = rate + '%';
        }
        
        async function runSingleTest(testCase, index) {
            log(`ğŸ§ª é–‹å§‹æ¸¬è©¦ ${index + 1}/${testCases.length}: ${testCase.name}`, 'info');
            updateStatus(`åŸ·è¡Œæ¸¬è©¦: ${testCase.name}`, 'running');
            
            try {
                if (!documentConverter) {
                    throw new Error('DocumentConverter å°šæœªåˆå§‹åŒ–');
                }
                
                const startTime = performance.now();
                let pdfBlob;
                
                if (testCase.type === 'text') {
                    pdfBlob = await documentConverter.convertTextToPdf(testCase.content, testCase.filename);
                }
                
                const endTime = performance.now();
                const duration = Math.round(endTime - startTime);
                
                if (!pdfBlob || pdfBlob.size === 0) {
                    throw new Error('ç”¢ç”Ÿçš„ PDF æª”æ¡ˆç‚ºç©º');
                }
                
                const result = {
                    name: testCase.name,
                    success: true,
                    fileSize: pdfBlob.size,
                    duration: duration,
                    timestamp: new Date(),
                    blob: pdfBlob
                };
                
                testResults.push(result);
                log(`âœ… ${testCase.name} æ¸¬è©¦é€šéï¼æª”æ¡ˆå¤§å°: ${pdfBlob.size} bytes, è€—æ™‚: ${duration}ms`, 'success');
                
                // è‡ªå‹•ä¸‹è¼‰ PDF æª”æ¡ˆ
                downloadBlob(pdfBlob, testCase.filename);
                
                return result;
                
            } catch (error) {
                const result = {
                    name: testCase.name,
                    success: false,
                    error: error.message,
                    timestamp: new Date()
                };
                
                testResults.push(result);
                log(`âŒ ${testCase.name} æ¸¬è©¦å¤±æ•—: ${error.message}`, 'error');
                console.error('è©³ç´°éŒ¯èª¤:', error);
                
                return result;
            }
        }
        
        async function runComprehensiveTest() {
            if (isTestingInProgress) {
                log('âš ï¸ æ¸¬è©¦å·²åœ¨é€²è¡Œä¸­', 'warning');
                return;
            }
            
            isTestingInProgress = true;
            const startBtn = document.getElementById('startBtn');
            startBtn.disabled = true;
            startBtn.textContent = 'ğŸ”„ æ¸¬è©¦ä¸­...';
            
            testResults = [];
            updateStats();
            log('ğŸš€ é–‹å§‹å…¨é¢æ¸¬è©¦...', 'info');
            
            try {
                for (let i = 0; i < testCases.length; i++) {
                    const progress = Math.round(((i + 1) / testCases.length) * 100);
                    updateProgress(progress, `åŸ·è¡Œæ¸¬è©¦ ${i + 1}/${testCases.length}`);
                    
                    await runSingleTest(testCases[i], i);
                    updateStats();
                    
                    // æ¯å€‹æ¸¬è©¦ä¹‹é–“ç¨ä½œæš«åœ
                    await new Promise(resolve => setTimeout(resolve, 500));
                }
                
                // ç”Ÿæˆæœ€çµ‚å ±å‘Š
                generateFinalReport();
                log('ğŸ‰ æ‰€æœ‰æ¸¬è©¦å®Œæˆï¼', 'success');
                updateStatus('æ‰€æœ‰æ¸¬è©¦å®Œæˆ', 'success');
                
            } catch (error) {
                log(`âŒ æ¸¬è©¦éç¨‹ç™¼ç”ŸéŒ¯èª¤: ${error.message}`, 'error');
                updateStatus('æ¸¬è©¦å¤±æ•—', 'error');
            } finally {
                isTestingInProgress = false;
                startBtn.disabled = false;
                startBtn.textContent = 'ğŸš€ é–‹å§‹å…¨é¢æ¸¬è©¦';
                updateProgress(100, 'æ¸¬è©¦å®Œæˆ');
            }
        }
        
        async function runQuickTest() {
            log('âš¡ åŸ·è¡Œå¿«é€Ÿæ¸¬è©¦...', 'info');
            updateStatus('åŸ·è¡Œå¿«é€Ÿæ¸¬è©¦', 'running');
            
            const quickTestCase = testCases[0]; // åŸºæœ¬æ–‡å­—æ¸¬è©¦
            await runSingleTest(quickTestCase, 0);
            updateStats();
            generateFinalReport();
        }
        
        function generateFinalReport() {
            const passed = testResults.filter(r => r.success).length;
            const total = testResults.length;
            const successRate = total > 0 ? Math.round((passed / total) * 100) : 0;
            
            let report = `\nğŸ“‹ æ¸¬è©¦å ±å‘Š (${new Date().toLocaleString()})\n`;
            report += `${'='.repeat(50)}\n`;
            report += `ç¸½æ¸¬è©¦æ•¸: ${total}\n`;
            report += `é€šéæ¸¬è©¦: ${passed}\n`;
            report += `å¤±æ•—æ¸¬è©¦: ${total - passed}\n`;
            report += `æˆåŠŸç‡: ${successRate}%\n\n`;
            
            if (successRate === 100) {
                report += 'ğŸ‰ æ‰€æœ‰æ¸¬è©¦é€šéï¼PDF è½‰æª”åŠŸèƒ½å®Œå…¨æ­£å¸¸ï¼\n';
            } else if (successRate >= 80) {
                report += 'âœ… å¤§éƒ¨åˆ†æ¸¬è©¦é€šéï¼ŒåŠŸèƒ½åŸºæœ¬æ­£å¸¸\n';
            } else {
                report += 'âš ï¸ å¤šå€‹æ¸¬è©¦å¤±æ•—ï¼Œéœ€è¦é€²ä¸€æ­¥æª¢æŸ¥\n';
            }
            
            log(report, successRate === 100 ? 'success' : successRate >= 80 ? 'warning' : 'error');
            
            document.getElementById('testStatus').innerHTML = 
                successRate === 100 ? 'ğŸ‰ æ‰€æœ‰åŠŸèƒ½æ­£å¸¸ï¼' :
                successRate >= 80 ? 'âœ… åŸºæœ¬åŠŸèƒ½æ­£å¸¸' :
                'âŒ éœ€è¦ä¿®å¾©';
        }
        
        function downloadBlob(blob, filename) {
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            a.style.display = 'none';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            setTimeout(() => URL.revokeObjectURL(url), 1000);
        }
        
        function clearAllResults() {
            testResults = [];
            updateStats();
            document.getElementById('testStatus').textContent = 'ç³»çµ±æº–å‚™å°±ç·’';
            document.getElementById('lastResult').textContent = '';
            updateStatus('ç­‰å¾…é–‹å§‹æ¸¬è©¦', 'pending');
            updateProgress(0, 'æº–å‚™é–‹å§‹æ¸¬è©¦...');
            log('ğŸ§¹ æ‰€æœ‰çµæœå·²æ¸…é™¤', 'info');
        }
        
        function clearConsole() {
            document.getElementById('console').innerHTML = '';
        }
        
        function exportLogs() {
            const consoleContent = document.getElementById('console').textContent;
            const blob = new Blob([consoleContent], { type: 'text/plain' });
            downloadBlob(blob, 'pdf-test-logs.txt');
        }
        
        function downloadTestReport() {
            if (testResults.length === 0) {
                log('âš ï¸ å°šç„¡æ¸¬è©¦çµæœå¯åŒ¯å‡º', 'warning');
                return;
            }
            
            const report = {
                timestamp: new Date().toISOString(),
                summary: {
                    total: testResults.length,
                    passed: testResults.filter(r => r.success).length,
                    failed: testResults.filter(r => !r.success).length
                },
                results: testResults.map(r => ({
                    name: r.name,
                    success: r.success,
                    fileSize: r.fileSize,
                    duration: r.duration,
                    error: r.error,
                    timestamp: r.timestamp
                }))
            };
            
            const blob = new Blob([JSON.stringify(report, null, 2)], { type: 'application/json' });
            downloadBlob(blob, 'pdf-test-report.json');
            log('ğŸ“Š æ¸¬è©¦å ±å‘Šå·²åŒ¯å‡º', 'success');
        }
        
        // é é¢è¼‰å…¥åˆå§‹åŒ–
        window.addEventListener('load', function() {
            log('ğŸ“„ æ¸¬è©¦ç³»çµ±è¼‰å…¥å®Œæˆ', 'info');
            updateProgress(0, 'ç­‰å¾…å‡½å¼åº«è¼‰å…¥...');
        });
    </script>
</body>
</html>