<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>æ ¼å¼è½‰æ›é©—è­‰æ¸¬è©¦</title>
    <style>
        body { font-family: -apple-system, sans-serif; margin: 20px; }
        .test-card { background: white; padding: 20px; margin: 15px 0; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 12px 24px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 5px; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <div class="test-card">
        <h1>ğŸ” æ ¼å¼è½‰æ›é©—è­‰æ¸¬è©¦</h1>
        <p>æ¸¬è©¦æ‰€æœ‰è¼¸å‡ºæ ¼å¼æ˜¯å¦æ­£å¸¸å·¥ä½œï¼Œç¢ºèªä¸æœƒåªè¼¸å‡º TXT æ ¼å¼</p>
        
        <button onclick="testAllFormats()">ğŸš€ æ¸¬è©¦æ‰€æœ‰æ ¼å¼</button>
        <button onclick="clearResults()">ğŸ§¹ æ¸…é™¤çµæœ</button>
        
        <div id="results"></div>
    </div>
    
    <!-- è¼‰å…¥æœ€æ–°ç‰ˆæœ¬çš„ PresentationConverter -->
    <script>
        const timestamp = new Date().getTime();
        const script = document.createElement('script');
        script.src = `assets/js/converters/presentation.js?v=${timestamp}`;
        document.head.appendChild(script);
    </script>
    
    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            document.getElementById('results').appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testAllFormats() {
            clearResults();
            log('ğŸ” é–‹å§‹æ ¼å¼è½‰æ›é©—è­‰æ¸¬è©¦...', 'info');

            // ç­‰å¾… PresentationConverter è¼‰å…¥
            if (typeof PresentationConverter === 'undefined') {
                log('â³ ç­‰å¾… PresentationConverter è¼‰å…¥...', 'info');
                await new Promise(resolve => {
                    const checkInterval = setInterval(() => {
                        if (typeof PresentationConverter !== 'undefined') {
                            clearInterval(checkInterval);
                            resolve();
                        }
                    }, 100);
                });
            }

            log('âœ… PresentationConverter å·²è¼‰å…¥', 'success');

            // æª¢æŸ¥æ–¹æ³•æ˜¯å¦å­˜åœ¨
            const methods = ['convertToPdf', 'convertToHtml', 'convertToText'];
            let allMethodsExist = true;
            
            methods.forEach(method => {
                if (typeof PresentationConverter[method] === 'function') {
                    log(`âœ… ${method} æ–¹æ³•å­˜åœ¨`, 'success');
                } else {
                    log(`âŒ ${method} æ–¹æ³•ä¸å­˜åœ¨`, 'error');
                    allMethodsExist = false;
                }
            });

            if (!allMethodsExist) {
                log('âŒ éƒ¨åˆ†è½‰æ›æ–¹æ³•ä¸å­˜åœ¨ï¼Œç„¡æ³•é€²è¡Œæ¸¬è©¦', 'error');
                return;
            }

            // å»ºç«‹æ¸¬è©¦è³‡æ–™
            const testContent = {
                title: 'æ ¼å¼æ¸¬è©¦ç°¡å ±',
                slides: [
                    {
                        slideNumber: 1,
                        title: 'æ¸¬è©¦æŠ•å½±ç‰‡ 1',
                        content: ['é€™æ˜¯æ¸¬è©¦å…§å®¹', 'ç”¨æ–¼é©—è­‰æ ¼å¼è½‰æ›åŠŸèƒ½', 'ä¸­æ–‡å­—ç¬¦ï¼šä½ å¥½ä¸–ç•Œ'],
                        notes: 'æ¸¬è©¦å‚™è¨» 1'
                    },
                    {
                        slideNumber: 2,
                        title: 'æ¸¬è©¦æŠ•å½±ç‰‡ 2',
                        content: ['ç¬¬äºŒå¼µæŠ•å½±ç‰‡', 'åŒ…å«æ›´å¤šå…§å®¹', 'æ•¸å­—ï¼š123456'],
                        notes: 'æ¸¬è©¦å‚™è¨» 2'
                    }
                ],
                totalSlides: 2
            };

            const title = 'æ ¼å¼è½‰æ›æ¸¬è©¦';
            const testResults = {};

            // æ¸¬è©¦ PDF è½‰æ›
            try {
                log('ğŸ“„ æ¸¬è©¦ PDF è½‰æ›...', 'info');
                const pdfBlob = await PresentationConverter.convertToPdf(testContent, title);
                
                if (pdfBlob instanceof Blob && pdfBlob.type === 'application/pdf' && pdfBlob.size > 0) {
                    testResults.pdf = { success: true, size: pdfBlob.size, type: pdfBlob.type };
                    log(`âœ… PDF è½‰æ›æˆåŠŸï¼å¤§å°: ${(pdfBlob.size/1024).toFixed(1)} KB, é¡å‹: ${pdfBlob.type}`, 'success');
                    
                    // é©—è­‰ PDF å…§å®¹
                    const arrayBuffer = await pdfBlob.arrayBuffer();
                    const header = new Uint8Array(arrayBuffer.slice(0, 4));
                    const headerString = String.fromCharCode(...header);
                    if (headerString === '%PDF') {
                        log('âœ… PDF æª”æ¡ˆæ ¼å¼é©—è­‰é€šé', 'success');
                    } else {
                        log('âŒ PDF æª”æ¡ˆæ ¼å¼é©—è­‰å¤±æ•—', 'error');
                    }
                } else {
                    testResults.pdf = { success: false, error: 'ç”¢ç”Ÿçš„ä¸æ˜¯æœ‰æ•ˆçš„ PDF Blob' };
                    log('âŒ PDF è½‰æ›å¤±æ•—ï¼šç”¢ç”Ÿçš„ä¸æ˜¯æœ‰æ•ˆçš„ PDF', 'error');
                }
            } catch (error) {
                testResults.pdf = { success: false, error: error.message };
                log(`âŒ PDF è½‰æ›éŒ¯èª¤: ${error.message}`, 'error');
            }

            // æ¸¬è©¦ HTML è½‰æ›
            try {
                log('ğŸŒ æ¸¬è©¦ HTML è½‰æ›...', 'info');
                const htmlBlob = PresentationConverter.convertToHtml(testContent, title);
                
                if (htmlBlob instanceof Blob && htmlBlob.type === 'text/html;charset=utf-8' && htmlBlob.size > 0) {
                    testResults.html = { success: true, size: htmlBlob.size, type: htmlBlob.type };
                    log(`âœ… HTML è½‰æ›æˆåŠŸï¼å¤§å°: ${htmlBlob.size} bytes, é¡å‹: ${htmlBlob.type}`, 'success');
                    
                    // é©—è­‰ HTML å…§å®¹
                    const htmlText = await htmlBlob.text();
                    if (htmlText.includes('<!DOCTYPE html>') && htmlText.includes(title)) {
                        log('âœ… HTML å…§å®¹é©—è­‰é€šé', 'success');
                    } else {
                        log('âŒ HTML å…§å®¹é©—è­‰å¤±æ•—', 'error');
                    }
                } else {
                    testResults.html = { success: false, error: 'ç”¢ç”Ÿçš„ä¸æ˜¯æœ‰æ•ˆçš„ HTML Blob' };
                    log('âŒ HTML è½‰æ›å¤±æ•—ï¼šç”¢ç”Ÿçš„ä¸æ˜¯æœ‰æ•ˆçš„ HTML', 'error');
                }
            } catch (error) {
                testResults.html = { success: false, error: error.message };
                log(`âŒ HTML è½‰æ›éŒ¯èª¤: ${error.message}`, 'error');
            }

            // æ¸¬è©¦ TXT è½‰æ›
            try {
                log('ğŸ“ æ¸¬è©¦ TXT è½‰æ›...', 'info');
                const txtBlob = PresentationConverter.convertToText(testContent, title);
                
                if (txtBlob instanceof Blob && txtBlob.type === 'text/plain;charset=utf-8' && txtBlob.size > 0) {
                    testResults.txt = { success: true, size: txtBlob.size, type: txtBlob.type };
                    log(`âœ… TXT è½‰æ›æˆåŠŸï¼å¤§å°: ${txtBlob.size} bytes, é¡å‹: ${txtBlob.type}`, 'success');
                    
                    // é©—è­‰ TXT å…§å®¹
                    const txtText = await txtBlob.text();
                    if (txtText.includes(title) && txtText.includes('æ¸¬è©¦æŠ•å½±ç‰‡ 1')) {
                        log('âœ… TXT å…§å®¹é©—è­‰é€šé', 'success');
                    } else {
                        log('âŒ TXT å…§å®¹é©—è­‰å¤±æ•—', 'error');
                    }
                } else {
                    testResults.txt = { success: false, error: 'ç”¢ç”Ÿçš„ä¸æ˜¯æœ‰æ•ˆçš„ TXT Blob' };
                    log('âŒ TXT è½‰æ›å¤±æ•—ï¼šç”¢ç”Ÿçš„ä¸æ˜¯æœ‰æ•ˆçš„ TXT', 'error');
                }
            } catch (error) {
                testResults.txt = { success: false, error: error.message };
                log(`âŒ TXT è½‰æ›éŒ¯èª¤: ${error.message}`, 'error');
            }

            // ç¸½çµå ±å‘Š
            log('', 'info'); // ç©ºè¡Œ
            log('ğŸ“Š æ¸¬è©¦çµæœç¸½çµ:', 'info');
            
            const successCount = Object.values(testResults).filter(r => r.success).length;
            const totalTests = Object.keys(testResults).length;
            
            Object.entries(testResults).forEach(([format, result]) => {
                if (result.success) {
                    log(`âœ… ${format.toUpperCase()}: æˆåŠŸ (å¤§å°: ${result.size} bytes, é¡å‹: ${result.type})`, 'success');
                } else {
                    log(`âŒ ${format.toUpperCase()}: å¤±æ•— - ${result.error}`, 'error');
                }
            });

            if (successCount === totalTests) {
                log(`ğŸ‰ æ‰€æœ‰ ${totalTests} é …è½‰æ›æ¸¬è©¦éƒ½æˆåŠŸï¼ç°¡å ±è½‰æ›å™¨æ ¼å¼åŠŸèƒ½å·²ä¿®å¾©ã€‚`, 'success');
                log('âœ… ç¢ºèªä¸æœƒåªè¼¸å‡º TXT æ ¼å¼ï¼Œæ‰€æœ‰æ ¼å¼éƒ½èƒ½æ­£ç¢ºè½‰æ›', 'success');
            } else {
                log(`âš ï¸ ${totalTests} é …æ¸¬è©¦ä¸­æœ‰ ${successCount} é …æˆåŠŸï¼Œ${totalTests - successCount} é …å¤±æ•—ã€‚`, 'error');
                
                if (testResults.pdf && !testResults.pdf.success && testResults.html && !testResults.html.success && testResults.txt && testResults.txt.success) {
                    log('âš ï¸ æª¢æ¸¬åˆ°åªæœ‰ TXT æ ¼å¼æˆåŠŸï¼ŒPDF å’Œ HTML è½‰æ›å¯èƒ½ä»æœ‰å•é¡Œ', 'error');
                }
            }
        }

        // é é¢è¼‰å…¥å®Œæˆå¾Œçš„åˆå§‹æª¢æŸ¥
        window.addEventListener('load', function() {
            setTimeout(() => {
                log('ğŸš€ æ ¼å¼è½‰æ›é©—è­‰é é¢è¼‰å…¥å®Œæˆ', 'info');
                log('âš¡ ä½¿ç”¨æ™‚é–“æˆ³ç¢ºä¿è¼‰å…¥æœ€æ–°ç‰ˆæœ¬çš„ç¨‹å¼ç¢¼', 'info');
            }, 500);
        });
    </script>
</body>
</html>