<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ç°¡å ±æ ¼å¼è½‰æ›é©—è­‰</title>
    <style>
        body { font-family: 'Microsoft YaHei', sans-serif; margin: 20px; }
        .test-result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
        button { padding: 10px 20px; margin: 5px; background: #007bff; color: white; border: none; border-radius: 5px; cursor: pointer; }
        button:hover { background: #0056b3; }
    </style>
</head>
<body>
    <h1>ğŸ“Š ç°¡å ±æ ¼å¼è½‰æ›é©—è­‰</h1>
    <button onclick="testAllFormats()">ğŸš€ æ¸¬è©¦æ‰€æœ‰æ ¼å¼è½‰æ›</button>
    <button onclick="clearResults()">ğŸ§¹ æ¸…é™¤çµæœ</button>
    
    <div id="results"></div>
    
    <script src="assets/js/converters/presentation.js"></script>
    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `test-result ${type}`;
            div.innerHTML = `<strong>${new Date().toLocaleTimeString()}</strong> - ${message}`;
            document.getElementById('results').appendChild(div);
        }

        function clearResults() {
            document.getElementById('results').innerHTML = '';
        }

        async function testAllFormats() {
            clearResults();
            log('ğŸ” é–‹å§‹æ¸¬è©¦ç°¡å ±æ ¼å¼è½‰æ›åŠŸèƒ½...', 'info');

            // æ¸¬è©¦è³‡æ–™
            const testContent = {
                title: 'æ¸¬è©¦ç°¡å ±',
                slides: [
                    {
                        slideNumber: 1,
                        title: 'ç¬¬ä¸€å¼µæŠ•å½±ç‰‡',
                        content: ['é€™æ˜¯ç¬¬ä¸€å¼µæŠ•å½±ç‰‡çš„å…§å®¹', 'åŒ…å«ä¸­æ–‡å­—ç¬¦æ¸¬è©¦', 'æ¸¬è©¦åˆ—è¡¨é …ç›®'],
                        notes: 'é€™æ˜¯ç¬¬ä¸€å¼µæŠ•å½±ç‰‡çš„å‚™è¨»'
                    },
                    {
                        slideNumber: 2,
                        title: 'ç¬¬äºŒå¼µæŠ•å½±ç‰‡',
                        content: ['æ¸¬è©¦æ›´å¤šå…§å®¹', 'æ•¸å­—ï¼š1234567890', 'ç‰¹æ®Šå­—ç¬¦ï¼š!@#$%^&*()'],
                        notes: 'ç¬¬äºŒå¼µæŠ•å½±ç‰‡å‚™è¨»'
                    }
                ],
                totalSlides: 2
            };

            const title = 'æ ¼å¼è½‰æ›æ¸¬è©¦';
            const results = {};

            // æ¸¬è©¦ PDF è½‰æ›
            try {
                log('ğŸ“„ æ¸¬è©¦ PDF è½‰æ›...', 'info');
                const pdfBlob = await PresentationConverter.convertToPdf(testContent, title);
                if (pdfBlob && pdfBlob.size > 0) {
                    results.pdf = { success: true, size: pdfBlob.size };
                    log(`âœ… PDF è½‰æ›æˆåŠŸï¼å¤§å°: ${pdfBlob.size} bytes`, 'success');
                    
                    // é©—è­‰ PDF æ¨™é ­
                    const arrayBuffer = await pdfBlob.arrayBuffer();
                    const header = new Uint8Array(arrayBuffer.slice(0, 4));
                    const headerString = String.fromCharCode(...header);
                    if (headerString === '%PDF') {
                        log('âœ… PDF æª”æ¡ˆæ ¼å¼é©—è­‰é€šé', 'success');
                    } else {
                        log('âŒ PDF æª”æ¡ˆæ ¼å¼é©—è­‰å¤±æ•—', 'error');
                    }
                } else {
                    results.pdf = { success: false, error: 'ç”Ÿæˆç©ºæª”æ¡ˆ' };
                    log('âŒ PDF è½‰æ›å¤±æ•—ï¼šç”Ÿæˆç©ºæª”æ¡ˆ', 'error');
                }
            } catch (error) {
                results.pdf = { success: false, error: error.message };
                log(`âŒ PDF è½‰æ›éŒ¯èª¤: ${error.message}`, 'error');
            }

            // æ¸¬è©¦ HTML è½‰æ›
            try {
                log('ğŸŒ æ¸¬è©¦ HTML è½‰æ›...', 'info');
                const htmlBlob = PresentationConverter.convertToHtml(testContent, title);
                if (htmlBlob && htmlBlob.size > 0) {
                    results.html = { success: true, size: htmlBlob.size };
                    log(`âœ… HTML è½‰æ›æˆåŠŸï¼å¤§å°: ${htmlBlob.size} bytes`, 'success');
                    
                    // é©—è­‰ HTML å…§å®¹
                    const htmlText = await htmlBlob.text();
                    if (htmlText.includes('<!DOCTYPE html>') && htmlText.includes(title)) {
                        log('âœ… HTML å…§å®¹é©—è­‰é€šé', 'success');
                    } else {
                        log('âŒ HTML å…§å®¹é©—è­‰å¤±æ•—', 'error');
                    }
                } else {
                    results.html = { success: false, error: 'ç”Ÿæˆç©ºæª”æ¡ˆ' };
                    log('âŒ HTML è½‰æ›å¤±æ•—ï¼šç”Ÿæˆç©ºæª”æ¡ˆ', 'error');
                }
            } catch (error) {
                results.html = { success: false, error: error.message };
                log(`âŒ HTML è½‰æ›éŒ¯èª¤: ${error.message}`, 'error');
            }

            // æ¸¬è©¦ TXT è½‰æ›
            try {
                log('ğŸ“ æ¸¬è©¦ TXT è½‰æ›...', 'info');
                const txtBlob = PresentationConverter.convertToText(testContent, title);
                if (txtBlob && txtBlob.size > 0) {
                    results.txt = { success: true, size: txtBlob.size };
                    log(`âœ… TXT è½‰æ›æˆåŠŸï¼å¤§å°: ${txtBlob.size} bytes`, 'success');
                    
                    // é©—è­‰ TXT å…§å®¹
                    const txtText = await txtBlob.text();
                    if (txtText.includes(title) && txtText.includes('æŠ•å½±ç‰‡ 1')) {
                        log('âœ… TXT å…§å®¹é©—è­‰é€šé', 'success');
                    } else {
                        log('âŒ TXT å…§å®¹é©—è­‰å¤±æ•—', 'error');
                    }
                } else {
                    results.txt = { success: false, error: 'ç”Ÿæˆç©ºæª”æ¡ˆ' };
                    log('âŒ TXT è½‰æ›å¤±æ•—ï¼šç”Ÿæˆç©ºæª”æ¡ˆ', 'error');
                }
            } catch (error) {
                results.txt = { success: false, error: error.message };
                log(`âŒ TXT è½‰æ›éŒ¯èª¤: ${error.message}`, 'error');
            }

            // ç¸½çµå ±å‘Š
            const successCount = Object.values(results).filter(r => r.success).length;
            const totalTests = Object.keys(results).length;
            
            log('', 'info'); // ç©ºè¡Œ
            log('ğŸ“Š æ¸¬è©¦çµæœç¸½çµ:', 'info');
            Object.entries(results).forEach(([format, result]) => {
                if (result.success) {
                    log(`âœ… ${format.toUpperCase()}: æˆåŠŸ (${result.size} bytes)`, 'success');
                } else {
                    log(`âŒ ${format.toUpperCase()}: å¤±æ•— - ${result.error}`, 'error');
                }
            });

            if (successCount === totalTests) {
                log(`ğŸ‰ æ‰€æœ‰ ${totalTests} é …è½‰æ›æ¸¬è©¦éƒ½æˆåŠŸï¼ç°¡å ±è½‰æ›å™¨å·²ä¿®å¾©ã€‚`, 'success');
            } else {
                log(`âš ï¸ ${totalTests} é …æ¸¬è©¦ä¸­æœ‰ ${successCount} é …æˆåŠŸï¼Œ${totalTests - successCount} é …å¤±æ•—ã€‚`, 'error');
            }
        }

        // é é¢è¼‰å…¥å¾Œè‡ªå‹•æª¢æŸ¥
        window.addEventListener('load', function() {
            log('ğŸš€ ç°¡å ±æ ¼å¼è½‰æ›é©—è­‰é é¢è¼‰å…¥å®Œæˆ', 'info');
            
            if (typeof PresentationConverter !== 'undefined') {
                log('âœ… PresentationConverter é¡åˆ¥è¼‰å…¥æˆåŠŸ', 'success');
                
                // æª¢æŸ¥æ–¹æ³•æ˜¯å¦å­˜åœ¨
                const methods = ['convertToPdf', 'convertToHtml', 'convertToText'];
                methods.forEach(method => {
                    if (typeof PresentationConverter[method] === 'function') {
                        log(`âœ… ${method} æ–¹æ³•å­˜åœ¨`, 'success');
                    } else {
                        log(`âŒ ${method} æ–¹æ³•ä¸å­˜åœ¨`, 'error');
                    }
                });
            } else {
                log('âŒ PresentationConverter é¡åˆ¥è¼‰å…¥å¤±æ•—', 'error');
            }
        });
    </script>
</body>
</html>