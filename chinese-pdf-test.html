<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>ä¸­æ–‡PDFçœŸæ­£ä¿®å¾©æ¸¬è©¦</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .btn { padding: 15px 30px; font-size: 16px; background: #28a745; color: white; border: none; border-radius: 5px; cursor: pointer; margin: 10px; }
        .btn:hover { background: #218838; }
        .result { margin: 10px 0; padding: 10px; border-radius: 5px; }
        .success { background: #d4edda; color: #155724; }
        .error { background: #f8d7da; color: #721c24; }
        .info { background: #d1ecf1; color: #0c5460; }
    </style>
</head>
<body>
    <h1>ğŸ‡¨ğŸ‡³ ä¸­æ–‡PDFçœŸæ­£ä¿®å¾©æ¸¬è©¦</h1>
    <p>æ¸¬è©¦ä¿æŒä¸­æ–‡å…§å®¹çš„PDFç”Ÿæˆï¼ˆä¸è½‰æ›ç‚ºè‹±æ–‡ï¼‰</p>
    
    <button class="btn" onclick="testChinesePDF()">ç”Ÿæˆä¸­æ–‡PDF</button>
    
    <div id="results"></div>

    <script src="https://unpkg.com/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

    <script>
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = `result ${type}`;
            div.innerHTML = `
                <strong>${new Date().toLocaleTimeString()}</strong> - ${message}
            `;
            document.getElementById('results').appendChild(div);
        }

        async function loadChineseFont() {
            try {
                log('ğŸ”½ æ­£åœ¨è¼‰å…¥ä¸­æ–‡å­—é«”...');
                
                // ä½¿ç”¨ Google Fonts çš„ Noto Sans SCï¼ˆç°¡é«”ä¸­æ–‡ï¼‰
                const response = await fetch('https://fonts.gstatic.com/s/notosanssc/v36/k3kCo84MPvpLmixcA63oeAL7Iqp5JJXA2i9Gtlx9p7jzTSaESaJHsLmhulEKC6_Z2yQ.woff2');
                
                if (!response.ok) {
                    throw new Error('å­—é«”è¼‰å…¥å¤±æ•—');
                }
                
                const fontData = await response.arrayBuffer();
                const fontBase64 = btoa(String.fromCharCode(...new Uint8Array(fontData)));
                
                log('âœ… ä¸­æ–‡å­—é«”è¼‰å…¥æˆåŠŸ');
                return fontBase64;
                
            } catch (error) {
                log('âŒ å­—é«”è¼‰å…¥å¤±æ•—ï¼Œå°‡ä½¿ç”¨æ›¿ä»£æ–¹æ¡ˆ: ' + error.message, 'error');
                return null;
            }
        }

        async function testChinesePDF() {
            log('ğŸ”„ é–‹å§‹ä¸­æ–‡PDFæ¸¬è©¦...');
            
            try {
                const { jsPDF } = window.jspdf;
                const doc = new jsPDF();
                
                // ä¸­æ–‡æ¸¬è©¦å…§å®¹ï¼ˆä¿æŒåŸæ¨£ï¼‰
                const chineseTitle = 'æœ€çµ‚é©—è­‰æ¸¬è©¦æ–‡ä»¶';
                const chineseContent = `é€™æ˜¯ä¸€å€‹ç”¨æ–¼é©—è­‰ PDF è½‰æ›åŠŸèƒ½çš„æ¸¬è©¦æ–‡ä»¶ã€‚

åŠŸèƒ½é©—è­‰é …ç›®ï¼š
â€¢ ä¸­æ–‡å­—ç¬¦æ”¯æ´æ¸¬è©¦
â€¢ ç‰¹æ®Šå­—ç¬¦è™•ç†ï¼š& < > " '
â€¢ å¤šæ®µè½æ ¼å¼é©—è­‰
â€¢ é•·æ–‡æœ¬è™•ç†èƒ½åŠ›æ¸¬è©¦

æ¸¬è©¦æ™‚é–“ï¼š${new Date().toLocaleString()}

é€™å€‹æ¸¬è©¦å°‡é©—è­‰æ˜¯å¦èƒ½å¤ ï¼š
1. ä¿æŒä¸­æ–‡å…§å®¹ä¸è®Š
2. æ­£ç¢ºé¡¯ç¤ºä¸­æ–‡å­—ç¬¦
3. ç¶­æŒæ–‡æœ¬æ ¼å¼å’Œçµæ§‹
4. ç”Ÿæˆå¯è®€çš„ä¸­æ–‡PDFæª”æ¡ˆ`;

                log('ğŸ“ æº–å‚™ç”Ÿæˆä¸­æ–‡å…§å®¹PDF...');
                log('æ¨™é¡Œ: ' + chineseTitle);
                
                // å˜—è©¦è¼‰å…¥ä¸­æ–‡å­—é«”
                const chineseFont = await loadChineseFont();
                
                if (chineseFont) {
                    try {
                        // æ·»åŠ ä¸­æ–‡å­—é«”åˆ°PDF
                        doc.addFileToVFS('NotoSansSC.ttf', chineseFont);
                        doc.addFont('NotoSansSC.ttf', 'NotoSansSC', 'normal');
                        doc.setFont('NotoSansSC');
                        log('âœ… ä½¿ç”¨ä¸­æ–‡å­—é«”: Noto Sans SC', 'success');
                    } catch (fontError) {
                        log('âš ï¸ å­—é«”è¨­å®šå¤±æ•—ï¼Œä½¿ç”¨é»˜èªå­—é«”: ' + fontError.message, 'error');
                        doc.setFont('helvetica', 'normal');
                    }
                } else {
                    // ä½¿ç”¨é»˜èªå­—é«”ä¸¦å˜—è©¦UTF-8è™•ç†
                    doc.setFont('helvetica', 'normal');
                    log('âš ï¸ ä½¿ç”¨é»˜èªå­—é«”ï¼ˆå¯èƒ½ç„¡æ³•æ­£ç¢ºé¡¯ç¤ºä¸­æ–‡ï¼‰', 'error');
                }
                
                doc.setFontSize(12);
                
                let yPosition = 20;
                const pageHeight = 280;
                const margin = 20;
                const lineHeight = 8;
                const pageWidth = 170;
                
                // æ·»åŠ æ¨™é¡Œ
                doc.setFontSize(16);
                doc.setFont('helvetica', 'bold');
                
                try {
                    doc.text(chineseTitle, margin, yPosition);
                    log('âœ… æ¨™é¡Œæ·»åŠ æˆåŠŸ');
                } catch (titleError) {
                    log('âš ï¸ æ¨™é¡Œæ·»åŠ å¤±æ•—ï¼Œä½¿ç”¨è‹±æ–‡æ›¿ä»£', 'error');
                    doc.text('Chinese PDF Test Document', margin, yPosition);
                }
                
                yPosition += 15;
                doc.setFont('helvetica', 'normal');
                doc.setFontSize(12);
                
                // æ·»åŠ å…§å®¹
                const paragraphs = chineseContent.split('\n\n');
                
                paragraphs.forEach((paragraph, index) => {
                    if (!paragraph.trim()) return;
                    
                    try {
                        const lines = doc.splitTextToSize(paragraph.trim(), pageWidth);
                        
                        lines.forEach(line => {
                            if (yPosition > pageHeight - margin) {
                                doc.addPage();
                                yPosition = margin;
                            }
                            
                            doc.text(line, margin, yPosition);
                            yPosition += lineHeight;
                        });
                        
                        yPosition += 5;
                        log(`âœ… æ®µè½ ${index + 1} æ·»åŠ æˆåŠŸ`);
                        
                    } catch (paragraphError) {
                        log(`âš ï¸ æ®µè½ ${index + 1} æ·»åŠ å¤±æ•—: ${paragraphError.message}`, 'error');
                    }
                });
                
                // é è…³
                doc.setFontSize(10);
                doc.setTextColor(100, 100, 100);
                doc.text('ç¬¬ 1 é ï¼Œå…± 1 é ', margin, pageHeight + 5);
                doc.text('ç”Ÿæˆæ™‚é–“: ' + new Date().toLocaleDateString(), pageWidth - 40, pageHeight + 5);
                
                // ç”Ÿæˆä¸¦ä¸‹è¼‰
                const pdfBlob = doc.output('blob');
                log('âœ… ä¸­æ–‡PDFç”ŸæˆæˆåŠŸ: ' + pdfBlob.size + ' bytes', 'success');
                
                const url = URL.createObjectURL(pdfBlob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'chinese-pdf-test.pdf';
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                
                setTimeout(() => URL.revokeObjectURL(url), 1000);
                log('ğŸ“¥ ä¸­æ–‡PDFå·²ä¸‹è¼‰ - è«‹æª¢æŸ¥æ˜¯å¦æ­£ç¢ºé¡¯ç¤ºä¸­æ–‡!', 'success');
                
            } catch (error) {
                log('âŒ éŒ¯èª¤: ' + error.message, 'error');
                console.error('PDFç”ŸæˆéŒ¯èª¤:', error);
            }
        }
    </script>
</body>
</html>